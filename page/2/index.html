<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/160.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/160.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/160.jpg">
  <link rel="mask-icon" href="/images/160.jpg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"rickiewoo.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="We were both young when I first saw you.">
<meta property="og:type" content="website">
<meta property="og:title" content="Rickie Woo&#39;s Wonder Land">
<meta property="og:url" content="http://rickiewoo.github.io/page/2/index.html">
<meta property="og:site_name" content="Rickie Woo&#39;s Wonder Land">
<meta property="og:description" content="We were both young when I first saw you.">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Rickie Woo">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://rickiewoo.github.io/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Rickie Woo's Wonder Land</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta custom-logo">
      <div class="site-meta-headline">
        <a>
          <img class="custom-logo-image" src="/images/logo.png" alt="Rickie Woo's Wonder Land">
        </a>
      </div>

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Rickie Woo's Wonder Land</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Why is a raven like a writing-desk?</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>Schedule</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rickiewoo.github.io/2022/08/09/React%20hook/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/sasuke.jpeg">
      <meta itemprop="name" content="Author">
      <meta itemprop="description" content="We were both young when I first saw you.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rickie Woo's Wonder Land">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/08/09/React%20hook/" class="post-title-link" itemprop="url">React hook</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-08-09 22:09:02" itemprop="dateCreated datePublished" datetime="2022-08-09T22:09:02+08:00">2022-08-09</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/keep-learning/" itemprop="url" rel="index"><span itemprop="name">keep-learning</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="React-hook"><a href="#React-hook" class="headerlink" title="React hook"></a>React hook</h1><p>##Hook的优点</p>
<p>随时可用:<strong>Hook 使你在无需修改组件结构的情况下复用状态逻辑</strong></p>
<p><strong>Hook 将组件中相互关联的部分拆分成更小的函数（比如设置订阅或请求数据）</strong></p>
<p>向后兼容 且 没有Breaking-change</p>
<p>拥抱函数，在非class的情况下使用更多react特性</p>
<p>##什么是Hook</p>
<p>Hook 是一些可以让你在函数组件里“钩入” React state 及生命周期等特性的函数。Hook **不能在 class 组件中使用 **—— 这使得你不使用 class 也能使用 React。其实就是js函数</p>
<h2 id="Hook-使用规则"><a href="#Hook-使用规则" class="headerlink" title="Hook 使用规则"></a>Hook 使用规则</h2><ul>
<li>只能在<strong>函数最外层</strong>调用 Hook。不要在循环、条件判断或者子函数中调用。</li>
<li>只能在 <strong>React 的函数组件或自定义的 Hook 中</strong>中调用 Hook。</li>
<li>Hook 是一种复用<em>状态逻辑</em>的方式，它不复用 state 本身。事实上 Hook 的每次<em>调用</em>都有一个完全独立的 state —— 因此你可以在单个组件中多次调用同一个自定义 Hook。</li>
</ul>
<p>常用hook</p>
<ul>
<li>useState</li>
<li>useEffect<ul>
<li>跟 class 组件中的 <code>componentDidMount</code>、<code>componentDidUpdate</code> 和 <code>componentWillUnmount</code> 具有相同的用途</li>
<li>默认情况下，React 会在每次渲染后调用副作用函数 —— <strong>包括</strong>第一次渲染的时候</li>
<li>参数<ul>
<li>一个副作用的funtion<ul>
<li>返回值：返回一个函数指定如何清除副作用</li>
</ul>
</li>
<li>一个数组：如果这个数组中所有元素与上一次相等，则会跳过这次effect，性能优化点</li>
</ul>
</li>
<li></li>
</ul>
</li>
<li>useContext<ul>
<li>接受一个context对象，并返回他的value</li>
</ul>
</li>
<li>useReducer<ul>
<li><a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/docs/hooks-reference.html#usestate"><code>useState</code></a> 的替代方案</li>
</ul>
</li>
<li>useCallback</li>
<li>useMemo</li>
<li>userRef</li>
</ul>
<p>#React Context</p>
<h2 id="用途"><a href="#用途" class="headerlink" title="用途"></a>用途</h2><p><em>很多</em>不同层级的组件需要访问同样一些的数据</p>
<p>共享那些对于一个组件树而言是“全局”的数据，例如当前认证的用户、主题或首选语言</p>
<h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><h3 id="createContext"><a href="#createContext" class="headerlink" title="createContext"></a><code>createContext</code></h3><p>找离自身最近的provider并读取当前的值</p>
<p>参数defaultValue，注意defaultValue的生效时机</p>
<ul>
<li><p>没有匹配到provider时才生效</p>
</li>
<li><p>设置为undefined时不生效</p>
</li>
</ul>
<h3 id="Class-contextType"><a href="#Class-contextType" class="headerlink" title="Class.contextType"></a><code>Class.contextType</code></h3><p>会被重新赋值为Context对象，然后用this.context的时候会消费最近<code>context</code>上?的值 // TODO</p>
<h3 id="Context-Consumer"><a href="#Context-Consumer" class="headerlink" title="Context.Consumer"></a><code>Context.Consumer</code></h3><p>在<a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/docs/components-and-props.html#function-and-class-components">函数式组件</a>中可以订阅 context，检测变更</p>
<h3 id="Context-displayName"><a href="#Context-displayName" class="headerlink" title="Context.displayName"></a><code>Context.displayName</code></h3>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rickiewoo.github.io/2022/08/09/Redux/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/sasuke.jpeg">
      <meta itemprop="name" content="Author">
      <meta itemprop="description" content="We were both young when I first saw you.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rickie Woo's Wonder Land">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/08/09/Redux/" class="post-title-link" itemprop="url">Redux 学习笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-08-09 22:09:02" itemprop="dateCreated datePublished" datetime="2022-08-09T22:09:02+08:00">2022-08-09</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/keep-learning/" itemprop="url" rel="index"><span itemprop="name">keep-learning</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Redux"><a href="#Redux" class="headerlink" title="Redux"></a>Redux</h1><p>redux is powerful：redux可以追踪每一个变化背后的行为。</p>
<p><img src="https://miro.medium.com/max/825/1*N62EZSeQNHtwVumCQOdU-Q.png" alt="img"></p>
<h2 id="Redux与Flux"><a href="#Redux与Flux" class="headerlink" title="Redux与Flux"></a>Redux与Flux</h2><p><img src="https://user-gold-cdn.xitu.io/2019/3/24/169ad99f6092e26b?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="123"></p>
<p>Redux受到了Flux架构的启发，但在实现上有一些不同：</p>
<ul>
<li>Redux并没有 dispatcher。它依赖纯函数来替代事件处理器，也不需要额外的实体来管理它们。Flux尝尝被表述为：<code>(state, action) =&gt; state</code>，而纯函数也是实现了这一思想。</li>
<li>Redux为不可变数据集。在每次Action请求触发以后，Redux都会生成一个新的对象来更新State，而不是在当前状态上进行更改。</li>
<li>Redux有且只有一个Store对象。它的Store储存了整个应用程序的State。</li>
</ul>
<h2 id="术语及概念"><a href="#术语及概念" class="headerlink" title="术语及概念"></a>术语及概念</h2><h3 id="不变性"><a href="#不变性" class="headerlink" title="不变性"></a>不变性</h3><p>redux期望所有值的更新都是不变的，也就是说对于引用类型，我们需要复制deep原变量并在此基础上做更改。</p>
<h3 id="redux中的数据流"><a href="#redux中的数据流" class="headerlink" title="redux中的数据流"></a>redux中的数据流</h3><ul>
<li>init<ul>
<li>使用root reducer函数创建一个store</li>
<li>store调用一次reducer，并保存它的返回值作为自己的初始state</li>
<li>当UI初次渲染时，UI组件会访问store中当前的state，并使用里面的数据决定渲染什么。他们也会订阅store中任何未来的的更改来知道state是否发生了变化。</li>
</ul>
</li>
<li>updates<ul>
<li>一些事件发生，比如用户点击一个按钮</li>
<li>app代码派发一个行为到store，比如<code>dispatch(&#123;type: &#39;counter/increment&#39;&#125;)</code></li>
<li>store再次运行reducer的function，使用上一个state和当前action，并保存返回值作为新的state</li>
<li>store通知所有订阅store的UI：store已经更新了</li>
<li>每一个从store中获取数据的UI组件检查他们需要的这部分数据是否发生变化</li>
<li>每个看到其数据已更改的组件都会强制使用新数据重新渲染，因此它可以更新屏幕上显示的内容</li>
</ul>
</li>
</ul>
<!-- ![Redux data flow diagram](https://redux.js.org/assets/images/ReduxDataFlowDiagram-49fa8c3968371d9ef6f2a1486bd40a26.gif) -->

<h3 id="actions"><a href="#actions" class="headerlink" title="actions"></a>actions</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. plain object</span></span><br><span class="line"><span class="comment">// 2. has a type</span></span><br><span class="line"><span class="comment">// 3. whatever else you want</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">type</span>: <span class="string">&quot;USER_LOGGED_IN&quot;</span>,</span><br><span class="line">  username: <span class="string">&quot;rickieWoo&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>action是具有type属性的普通对象</p>
<h3 id="action-creators"><a href="#action-creators" class="headerlink" title="action creators"></a>action creators</h3><p>而且，由于总是手动编写这些对象会很烦人（更不用说容易出错），因此Redux具有“action creators”的概念，可以将这些内容淘汰掉</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">userLoggedIn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="keyword">type</span>: <span class="string">&#x27;USER_LOGGED_IN&#x27;</span>,</span><br><span class="line">    username: <span class="string">&#x27;dave&#x27;</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Redux-toolKit"><a href="#Redux-toolKit" class="headerlink" title="Redux toolKit"></a>Redux toolKit</h2><p>Immer library？</p>
<p>将变更检测存为草稿状态（draft state）并基于这些变更产生一个全新的不可变状态</p>
<p>⬆️在RTK中，reduder中的state是草稿state</p>
<h3 id="Thunk"><a href="#Thunk" class="headerlink" title="Thunk"></a>Thunk</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://daveceddia.com/what-is-a-thunk/">https://daveceddia.com/what-is-a-thunk/</a></p>
</blockquote>
<p>thunk是function的另一种说法，不过thunk特指返回一个function的function。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">wrapper_function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// this one is a &quot;thunk&quot; because it defers work for later:</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">thunk</span>(<span class="params"></span>) </span>&#123;   <span class="comment">// it can be named, or anonymous</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;do stuff now&#x27;</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rickiewoo.github.io/2022/08/09/RxJs%20-%E6%93%8D%E4%BD%9C%E7%AC%A6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/sasuke.jpeg">
      <meta itemprop="name" content="Author">
      <meta itemprop="description" content="We were both young when I first saw you.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rickie Woo's Wonder Land">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/08/09/RxJs%20-%E6%93%8D%E4%BD%9C%E7%AC%A6/" class="post-title-link" itemprop="url">RxJS 学习</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-08-09 22:09:02" itemprop="dateCreated datePublished" datetime="2022-08-09T22:09:02+08:00">2022-08-09</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/keep-learning/" itemprop="url" rel="index"><span itemprop="name">keep-learning</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="RxJs-学习"><a href="#RxJs-学习" class="headerlink" title="RxJs 学习"></a>RxJs 学习</h1><h2 id="操作符"><a href="#操作符" class="headerlink" title="操作符"></a>操作符</h2><h3 id="操作符的分类"><a href="#操作符的分类" class="headerlink" title="操作符的分类"></a>操作符的分类</h3><ul>
<li>按功能分类<ul>
<li>创建类：of、from</li>
<li>转化类： map</li>
<li>过滤类：filter</li>
<li>合并类：merge，combineLatest，fork</li>
<li>错误处理类：catchError</li>
<li>多播类：publishReplay？</li>
<li>辅助工具类</li>
<li>条件分支类</li>
<li>数学和合计类</li>
<li>背压控制类：zip<ul>
<li>背压：发大水时，下游无法让水流即使通过，水流淤积，逐步把压力传递给上游，这种现象称为背压</li>
</ul>
</li>
<li>可连接类：connnect，全部和多播有关</li>
<li>高阶Observable<ul>
<li>指产生数据本身也是Observablele对象的Observable对象。</li>
</ul>
</li>
</ul>
</li>
<li>静态和实例分类：都返回一个 Obsevable对象<ul>
<li>静态：只能出现在首部，不需要Observable实例就可以执行的函数，如of<ul>
<li>Observable.of = functionOf</li>
</ul>
</li>
<li>实例：Obsevable的实例函数，前提是有一个创建好的observable对象，如map<ul>
<li>Observable.prototype.map = functionMap</li>
</ul>
</li>
<li>这两个形式没有本质区别，在链式调用的中间位置只能用实例函数形式的操作符</li>
</ul>
</li>
</ul>
<h3 id="操作符的实现"><a href="#操作符的实现" class="headerlink" title="操作符的实现"></a>操作符的实现</h3><p>每个操作符都是一个函数，实现一个操作符必须考虑以下几点</p>
<ul>
<li>返回一个全新的Observable对象</li>
<li>对上游和下游的订阅及退订<ul>
<li>当不需要从某一个observable获取数据的时候，就退订这个observable</li>
</ul>
</li>
<li>处理异常情况<ul>
<li>捕获异常的错误并将其传递给下游</li>
<li>将上游的异常传递给下游</li>
</ul>
</li>
<li>及时释放资源<ul>
<li>DOM操作要注意相关Observeable的及时释放</li>
<li>Websocket等也是</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">map</span>(<span class="params">project</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Observbale(<span class="function"><span class="params">observer</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 假设this是上游的observable</span></span><br><span class="line">    <span class="keyword">const</span> sub = <span class="built_in">this</span>.subscribe(&#123;</span><br><span class="line">      next: <span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">          Observer.next(project(value))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">					Observer.error(e)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      error: <span class="function"><span class="params">error</span> =&gt;</span> Observer.error(error),</span><br><span class="line">      complete: <span class="function">() =&gt;</span> observer.complete()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">// 提供退订方法</span></span><br><span class="line">    unsubscribe: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      sub.unsubscribe()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="关联-Observable"><a href="#关联-Observable" class="headerlink" title="关联 Observable"></a>关联 Observable</h3><p>把上面的函数与 Observable 关联起来</p>
<p>####打补丁（会污染全局Observable</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Observable.prototypr.map = map</span><br></pre></td></tr></table></figure>

<p>####bind绑定特定 Observable 对象（无法使用链式调用</p>
<ul>
<li>缺点：无法使用链式调用（绑定操作符可解决问题，但是还未进入标准）</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使 map 中的 this 指向source$</span></span><br><span class="line"><span class="comment">// bind 产生一个新函数: map.bind(source$)</span></span><br><span class="line"><span class="keyword">const</span> result$ = map.bind(source$)(<span class="function"><span class="params">x</span> =&gt;</span> x*<span class="number">2</span>)</span><br><span class="line"><span class="comment">// call 立即执行原函数</span></span><br><span class="line"><span class="keyword">const</span> result$ = map.call(source$, <span class="function"><span class="params">x</span> =&gt;</span> x*<span class="number">2</span>)</span><br><span class="line"><span class="comment">// 连续使用两个 map</span></span><br><span class="line"><span class="keyword">const</span> result$ = map.bind(map.bind(source$)(<span class="function"><span class="params">x</span> =&gt;</span> x*<span class="number">2</span>))(<span class="function"><span class="params">x</span> =&gt;</span> x+<span class="number">1</span>)</span><br><span class="line"><span class="comment">// 绑定操作符链式调用</span></span><br><span class="line"><span class="keyword">const</span> result$ = source$:::map(<span class="function"><span class="params">x</span> =&gt;</span> x*<span class="number">2</span>)::map(<span class="function"><span class="params">x</span> =&gt;</span> x + <span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<h4 id="lift（应用层开发者很少使用"><a href="#lift（应用层开发者很少使用" class="headerlink" title="lift（应用层开发者很少使用"></a>lift（应用层开发者很少使用</h4><p>多是RxJs库的开发者使用，访问了this，违背了函数式编程的原则</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">map</span>(<span class="params">project</span>) </span>&#123;</span><br><span class="line">	<span class="comment">//【注意】：当 observable 的对象被订阅，lift的函数参数就会被调用，因此在这里的this与上文的指向不同</span></span><br><span class="line">  <span class="comment">// this：observer 的对象</span></span><br><span class="line">  <span class="comment">// source$：上游 Observable 的对象</span></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">this</span>.lift(<span class="function"><span class="keyword">function</span>(<span class="params">source$</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> source$.subscribe(&#123;</span><br><span class="line">      <span class="comment">// 内容与上文的sub一致</span></span><br><span class="line">      next: <span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">          Observer.next(project(value))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">					Observer.error(e)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      error: <span class="function"><span class="params">error</span> =&gt;</span> Observer.error(error),</span><br><span class="line">      complete: <span class="function">() =&gt;</span> observer.complete()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">Observable.prototype.map = map;</span><br></pre></td></tr></table></figure>

<h4 id="pipeable-操作符（letable操作符）"><a href="#pipeable-操作符（letable操作符）" class="headerlink" title="pipeable 操作符（letable操作符）"></a>pipeable 操作符（letable操作符）</h4><p>前面几个关联Observable 的方法实际上都违背了函数式编程的原则，因为在实现上都访问了this，那就多了一个改变函数行为的因素，不算纯函数了。</p>
<h5 id="操作符和-Observable-关联（打补丁）的缺点"><a href="#操作符和-Observable-关联（打补丁）的缺点" class="headerlink" title="操作符和 Observable 关联（打补丁）的缺点"></a>操作符和 Observable 关联（打补丁）的缺点</h5><ol>
<li>不能应用treeShaking</li>
<li>相当于修改了全局资源（Observable）</li>
<li>使用了 this ，不是纯函数</li>
</ol>
<h4 id="letable-和-pipeable-操作符"><a href="#letable-和-pipeable-操作符" class="headerlink" title="letable 和 pipeable 操作符"></a>letable 和 pipeable 操作符</h4><ul>
<li>静态类型操作符没有pipeable的形式</li>
<li>多个上游的操作符没有pipeable的形式</li>
<li>treeshaking可以保证没被引用的letable操作符不会进入打包文件</li>
</ul>
<h2 id="创建类操作符"><a href="#创建类操作符" class="headerlink" title="创建类操作符"></a>创建类操作符</h2><p><img src="../post-images/image-20200908104000444.png" alt="image-20200908104000444"></p>
<p>创建类操作符，并不是说返回一个observable的操作符，因为任何一个操作符都会返回observable，是指<em>不依赖其他observable对象</em>，完全可以凭空或者根据其他数据源创造一个observable对象，往往是数据的源头，因此<em>大部分创建类操作符都是静态操作符</em>。</p>
<h3 id="创建同步数据流"><a href="#创建同步数据流" class="headerlink" title="创建同步数据流"></a>创建同步数据流</h3><p>同步数据流不会关心时间相关的的问题，需要关心的是</p>
<ul>
<li>产生哪些数据</li>
<li>数据之间的先后顺序</li>
</ul>
<h4 id="create-基本用不上"><a href="#create-基本用不上" class="headerlink" title="create- 基本用不上"></a>create- 基本用不上</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Observable.create = <span class="function"><span class="keyword">function</span>(<span class="params">subscribe</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Observable(subscribe)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="of-列举数据"><a href="#of-列举数据" class="headerlink" title="of - 列举数据"></a>of - 列举数据</h4><p>产生的是<code>cold observable</code>，对于每一个Observer都会吐出相同的数据，所以可以反复使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> source$ = Observable.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="comment">// 同步发出1，2，3 并顺序排列</span></span><br></pre></td></tr></table></figure>

<h4 id="range-指定范围"><a href="#range-指定范围" class="headerlink" title="range - 指定范围"></a>range - 指定范围</h4><p>根据<code>第一个参数</code>（可以是非整数），每次递增<code>1</code>，第二个参数是<code>序列的长度</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> source$ = Observable.range(<span class="number">1</span>, <span class="number">100</span>)</span><br><span class="line"><span class="comment">// 同步发出1, 2, ... 100， 并顺序排列</span></span><br></pre></td></tr></table></figure>

<h4 id="generate-顺序创建（灵活的-for-循环）"><a href="#generate-顺序创建（灵活的-for-循环）" class="headerlink" title="generate - 顺序创建（灵活的 for 循环）"></a>generate - 顺序创建（灵活的 for 循环）</h4><p>相当于一个 for 循环</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> source$ = Observable.generate(</span><br><span class="line">  <span class="number">2</span>, <span class="comment">// 初始值 相当于for循环中的i=2</span></span><br><span class="line">  value =&gt; value &lt; <span class="number">10</span>, <span class="comment">// 继续的条件</span></span><br><span class="line">  value =&gt; value + <span class="number">2</span>, <span class="comment">// 每次循环中值的递增</span></span><br><span class="line">  value =&gt; value * value <span class="comment">// 产生的结果</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// 相当于⬇️</span></span><br><span class="line"><span class="keyword">let</span> source = []</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">2</span>; i &lt; <span class="number">10</span>; i += <span class="number">2</span>) &#123;</span><br><span class="line">  source.push(i * i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="repeat：重复数据的数据流（实例操作符"><a href="#repeat：重复数据的数据流（实例操作符" class="headerlink" title="repeat：重复数据的数据流（实例操作符"></a>repeat：重复数据的数据流（实例操作符</h4><p><code>repeat</code>的功能是重复上游数据流若干次</p>
<h4 id="单线程的-Javascript"><a href="#单线程的-Javascript" class="headerlink" title="单线程的 Javascript"></a>单线程的 Javascript</h4><p>JavaScript本身是一门单线程语言。当然，某些浏览器具有web worker功能，可以将没有web worker理解为一个线程，可以把JavaScript中执行的功能分配给多个线程。但是web worker具有一定的局限性：首先并不是所有浏览器都支持web worker，其次web worker访问资源会受限制，比如不能直接操作dom。</p>
<h6 id="多线程的缺点：竞态"><a href="#多线程的缺点：竞态" class="headerlink" title="多线程的缺点：竞态"></a>多线程的缺点：竞态</h6><p>当两个异步事件同时发生时，在线程A更新资源X时，线程B被激活，线程B更新完资源X后，线程A重新获得控制权，继续更新资源X，这样可能导致资源X同时被线程A和B更新，最终的数据结果紊乱，失去了数据的一致性。解决的办法利用加锁等机制限制多个线程对同一资源的访问。但是如果某个地方忘记加锁，就可能在关键的时候造成致命的问题。</p>
<h5 id="调用栈和事件循环"><a href="#调用栈和事件循环" class="headerlink" title="调用栈和事件循环"></a>调用栈和事件循环</h5><p>JavaScript的解析和运行环境统称为JavaScript引擎。引擎有许多种实现，其中Chrome和Nodejs使用的是V8引擎，edge使用的Chakra（脉轮：人体精神集中点之一）引擎，Firefox使用过gecko（壁虎）、TraceMonkey、JagerMonkey等。每个引擎都必须实现调用栈（call stack）和事件循环（event loop）的概念。</p>
<p>调用栈是每一门编程语言都有的概念。当调用一个函数的时候，就是在调用栈中创造这个函数的运行空间，函数的参数、局部变量的创建都是在调用栈中完成。当一个函数执行完毕，对应的调用栈上该函数的本次运行空间就会被清除。</p>
<p>调用栈的执行方式适合简单的数据运算，当函数之间的调用较多时，栈会变深，当函数执行完毕后，栈会变浅。而面对复杂的逻辑，就要用到事件循环。</p>
<p>在JavaScript中，事件循环的工作方式大致是：事件循环相当于一个死循环，不断从任务队列中取需要处理的任务，然后把这个任务交给调用栈执行，当这个任务结束后，就从任务队列中拿下一个需要处理的任务给调用栈……周而复始，永不停歇</p>
<p>注意，因为JavaScript是单线程的，所以当调用栈中有正在处理的任务时，事件循环不会去拿下一个任务，这就会导致明明setTimeOut的时间已经到了，但是实际上还要等上一个任务结束才能执行，时间并不真正准确。</p>
<p>而任务队列中的任务可以分为：micro task和macro task。事件队列并不只是一条队列，由于引擎的不同，会把不同的任务区分对待，比如setTimeOut和setInterval和时间相关的任务排成一列，网络请求排一队。当调用栈空闲时，事件循环就会从<em>优先级较高</em>的队列中拿下一个任务交给调用栈，当这个队列被清空后，再去下一个优先级较高的队列中拿任务。因此，一个任务想要执行，并不光是等待队列前面的任务，还可能要等待别的队列完成。</p>
<p>上面举例的任务都为macro task。micro task 在概念上只有一条队列，它是优先级最高的，每次调用栈空闲时，事件循环都会优先检查micro task的队列。不同的引擎micro task的定义不同，在V8引擎中，nextTick就是micro task，在某些引擎中 promise的the和catch也是micro task。微任务仅来自我们的代码。</p>
<p>更多关于调用栈的参考⬇️</p>
<p><a target="_blank" rel="noopener" href="https://github.com/mqyqingfeng/Blog/issues/4">https://github.com/mqyqingfeng/Blog/issues/4</a></p>
<p><a target="_blank" rel="noopener" href="https://javascript.info/event-loop">https://javascript.info/event-loop</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rickiewoo.github.io/2022/08/09/TemplateRef/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/sasuke.jpeg">
      <meta itemprop="name" content="Author">
      <meta itemprop="description" content="We were both young when I first saw you.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rickie Woo's Wonder Land">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/08/09/TemplateRef/" class="post-title-link" itemprop="url">TemplateRef 学习</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-08-09 22:09:02" itemprop="dateCreated datePublished" datetime="2022-08-09T22:09:02+08:00">2022-08-09</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/keep-learning/" itemprop="url" rel="index"><span itemprop="name">keep-learning</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="TemplateRef"><a href="#TemplateRef" class="headerlink" title="TemplateRef"></a>TemplateRef</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://angular.cn/api/core/TemplateRef">https://angular.cn/api/core/TemplateRef</a></p>
</blockquote>
<p>定义：表示一个内嵌模板，它可用于实例化内嵌的视图。</p>
<p>说明：通过把一个指令放在ng-template上，或一个带*前缀的指令，可以访问TemplatRef实例。</p>
<p>内嵌视图的TemplateRef实例会以TemplateRef作为token，注入到该指令的构造函数中。</p>
<p>属性：abstract elementRef: ElementRef</p>
<ul>
<li>当前内嵌视图在父视图的锚点元素</li>
<li>对于从这个 <code>TemplateRef</code> 创建的内嵌视图，其数据绑定和依赖注入的上下文是从<strong>当前位置</strong>的上下文中继承而来的。</li>
<li>通常，新的内嵌视图会被附加到当前位置的视图容器中，<strong>但是在一些高级用例中，该视图可能被附加到别的容器中， 同时还保留原位置的数据绑定和依赖注入上下文</strong>。</li>
</ul>
<p>方法：</p>
<ul>
<li><p>createEmbeddedView()</p>
<ul>
<li>创建一个视图对象，并把它附着到父视图的视图容器上。</li>
<li><img src="../post-images/WeChatWorkScreenshot_c87a6501-8bb3-4f25-a95c-d75d5876a763.png" alt="WeChatWorkScreenshot_c87a6501-8bb3-4f25-a95c-d75d5876a763"></li>
<li><img src="../post-images/image-20210322153553829.png" alt="image-20210322153553829"></li>
</ul>
<p>以下模板分别为两个单独的TemplateRef实例，一个外部实例和一个内部实例</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Count: &#123;&#123;items.length&#125;&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> *<span class="attr">ngFor</span>=<span class="string">&quot;let  item of items&quot;</span>&gt;</span>&#123;&#123;item&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--外部 TemplatRef--&gt;</span></span><br><span class="line">Count: &#123;&#123;items.length&#125;&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ng-template</span> <span class="attr">ngFor</span> <span class="attr">let-item</span> [<span class="attr">ngForOf</span>]=<span class="string">&quot;items&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ng-template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--内部 TemplatRef--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123;item&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 外部和内部 TemplateRef 实例按如下方式组装到视图中 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ViewRef: outer-0 --&gt;</span></span><br><span class="line">Count: 2</span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ng-template</span> <span class="attr">view-container-ref</span>&gt;</span><span class="tag">&lt;/<span class="name">ng-template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- ViewRef: inner-1 --&gt;</span><span class="tag">&lt;<span class="name">li</span>&gt;</span>first<span class="tag">&lt;/<span class="name">li</span>&gt;</span><span class="comment">&lt;!-- /ViewRef: inner-1 --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- ViewRef: inner-2 --&gt;</span><span class="tag">&lt;<span class="name">li</span>&gt;</span>second<span class="tag">&lt;/<span class="name">li</span>&gt;</span><span class="comment">&lt;!-- /ViewRef: inner-2 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /ViewRef: outer-0 --&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="template"><a href="#template" class="headerlink" title="template"></a>template</h4><!-- ![preview](https://segmentfault.com/img/bVKyfR?w=680&h=389/view) -->



<p>从上图中，我们发现 <template> 模板元素，渲染后被替换成 comment 元素，那么如何展示的呢？</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;Component, TemplateRef, ViewChild, AfterViewInit&#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">  selector: <span class="string">&#x27;my-app&#x27;</span>,</span><br><span class="line">  template: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;h1&gt;Welcome to Angular World&lt;/h1&gt;</span></span><br><span class="line"><span class="string">    &lt;template #tpl&gt;</span></span><br><span class="line"><span class="string">      &lt;span&gt;I am span in template&lt;/span&gt;</span></span><br><span class="line"><span class="string">    &lt;/template&gt;</span></span><br><span class="line"><span class="string">  `</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">AppComponent</span> </span>&#123;</span><br><span class="line">  name: <span class="built_in">string</span> = <span class="string">&#x27;Semlinker&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@ViewChild</span>(<span class="string">&#x27;tpl&#x27;</span>)</span><br><span class="line">  tpl: TemplateRef&lt;<span class="built_in">any</span>&gt;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">ngAfterViewInit</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> embeddedView = <span class="built_in">this</span>.tpl.createEmbeddedView(<span class="literal">null</span>);</span><br><span class="line">    <span class="built_in">console</span>.dir(embeddedView);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://segmentfault.com/img/bVKyfW?w=469&h=201" alt="图片描述"></p>
<p>从图中我们可以知道，当调用 createEmbeddedView 方法后返回了 ViewRef_ 视图对象。该视图对象的 rootNodes 属性包含了 <template> 模板中的内容。在上面的例子中，我们知道了 TemplateRef 实例对象中的 elementRef 属性封装了我们的 comment 元素，那么我们可以通过 insertBefore 方法来创建我们模板中定义的内容。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Component, TemplateRef, ViewChild, AfterViewInit &#125; from &#39;@angular&#x2F;core&#39;;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">  selector: &#39;my-app&#39;,</span><br><span class="line">  template: &#96;</span><br><span class="line">    &lt;h1&gt;Welcome to Angular World&lt;&#x2F;h1&gt;</span><br><span class="line">    &lt;template #tpl&gt;</span><br><span class="line">      &lt;span&gt;I am span in template &#123;&#123;name&#125;&#125;&lt;&#x2F;span&gt;</span><br><span class="line">    &lt;&#x2F;template&gt;</span><br><span class="line">  &#96;,</span><br><span class="line">&#125;)</span><br><span class="line">export class AppComponent &#123;</span><br><span class="line">  name: string &#x3D; &#39;Semlinker&#39;;</span><br><span class="line"></span><br><span class="line">  @ViewChild(&#39;tpl&#39;)</span><br><span class="line">  tpl: TemplateRef&lt;any&gt;;</span><br><span class="line"></span><br><span class="line">  ngAfterViewInit() &#123;</span><br><span class="line">    &#x2F;&#x2F; 页面中的&lt;!--template bindings&#x3D;&#123;&#125;--&gt;元素</span><br><span class="line">    let commentElement &#x3D; this.tpl.elementRef.nativeElement;</span><br><span class="line">    &#x2F;&#x2F; 创建内嵌视图</span><br><span class="line">    let embeddedView &#x3D; this.tpl.createEmbeddedView(null);</span><br><span class="line">    &#x2F;&#x2F; 动态添加子节点</span><br><span class="line">    embeddedView.rootNodes.forEach((node) &#x3D;&gt; &#123;</span><br><span class="line">        commentElement.parentNode</span><br><span class="line">          .insertBefore(node, commentElement.nextSibling);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>创建内嵌视图(embedded view)</li>
<li>遍历内嵌视图中的 rootNodes，动态的插入 node</li>
</ul>
<h3 id="ViewContainerRef"><a href="#ViewContainerRef" class="headerlink" title="ViewContainerRef"></a>ViewContainerRef</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://angular.cn/api/core/ViewContainerRef">https://angular.cn/api/core/ViewContainerRef</a></p>
</blockquote>
<p>表示可以将一个或多个视图附着到组件中的容器。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @angular/core/src/linker/view_container_ref.d.ts</span></span><br><span class="line"><span class="comment">// 用于表示一个视图容器，可添加一个或多个视图</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">declare</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewContainerRef_</span> <span class="title">implements</span> <span class="title">ViewContainerRef</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    length: <span class="built_in">number</span>; <span class="comment">// 返回视图容器中已存在的视图个数</span></span><br><span class="line">    element: ElementRef;</span><br><span class="line">    injector: Injector;</span><br><span class="line">    parentInjector: Injector;</span><br><span class="line">      <span class="comment">// 基于TemplateRef创建内嵌视图，并自动添加到视图容器中，可通过index设置</span></span><br><span class="line">    <span class="comment">// 视图添加的位置</span></span><br><span class="line">    createEmbeddedView&lt;C&gt;(templateRef: TemplateRef&lt;C&gt;, context?: C,</span><br><span class="line">      index?: <span class="built_in">number</span>): EmbeddedViewRef&lt;C&gt;;</span><br><span class="line">    <span class="comment">// 基 ComponentFactory创建组件视图</span></span><br><span class="line">    createComponent&lt;C&gt;(componentFactory: ComponentFactory&lt;C&gt;,</span><br><span class="line">      index?: <span class="built_in">number</span>, injector?: Injector, projectableNodes?: <span class="built_in">any</span>[][]): ComponentRef&lt;C&gt;;</span><br><span class="line">    insert(viewRef: ViewRef, index?: <span class="built_in">number</span>): ViewRef;</span><br><span class="line">    move(viewRef: ViewRef, <span class="attr">currentIndex</span>: <span class="built_in">number</span>): ViewRef;</span><br><span class="line">    indexOf(viewRef: ViewRef): <span class="built_in">number</span>;</span><br><span class="line">    remove(index?: <span class="built_in">number</span>): <span class="built_in">void</span>;</span><br><span class="line">    detach(index?: <span class="built_in">number</span>): ViewRef;</span><br><span class="line">    clear(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TemplateRef：用于表示内嵌的 template 模板元素，通过 TemplateRef 实例，我们可以方便创建内嵌视图(Embedded Views)，且可以轻松地访问到通过 ElementRef 封装后的 nativeElement。需要注意的是组件视图中的 template 模板元素，经过渲染后会被替换成 comment 元素。</p>
<p>ViewContainerRef：用于表示一个视图容器，可添加一个或多个视图。通过 ViewContainer<br>Ref 实例，我们可以基于 TemplateRef 实例创建内嵌视图，并能指定内嵌视图的插入位置，也可以方便对视图容器中已有的视图进行管理。简而言之，ViewContainerRef 的主要作用是创建和管理内嵌视图或组件视图。</p>
<h3 id="View"><a href="#View" class="headerlink" title="View"></a>View</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://angular.cn/guide/glossary#view">https://angular.cn/guide/glossary#view</a></p>
</blockquote>
<p>视图是可显示元素的最小分组单位，它们会被同时创建和销毁。 Angular 在一个或多个<a target="_blank" rel="noopener" href="https://angular.cn/guide/glossary#directive">指令 (directive)</a> 的控制下渲染视图。</p>
<p>具体实现上，视图由一个与该组件相关的 <code>ViewRef</code> 实例表示。 直属于某个组件的视图叫做<em>宿主视图</em>。 通常会把视图组织成一些<a target="_blank" rel="noopener" href="https://angular.cn/guide/glossary#view-tree">视图树（view hierarchies）</a>。</p>
<h3 id="EmbeddedViewRef"><a href="#EmbeddedViewRef" class="headerlink" title="EmbeddedViewRef"></a>EmbeddedViewRef</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://angular.cn/api/core/EmbeddedViewRef">https://angular.cn/api/core/EmbeddedViewRef</a></p>
</blockquote>
<p>表示视图容器中的 Angular <a target="_blank" rel="noopener" href="https://angular.cn/guide/glossary#view">视图</a>。<a target="_blank" rel="noopener" href="https://angular.cn/guide/glossary#view-tree">嵌入视图</a>可以从在模板中定义它的宿主组件之外的组件中引用，也可以由 <code>TemplateRef</code> 进行独立定义。</p>
<h3 id="ContentChild"><a href="#ContentChild" class="headerlink" title="ContentChild"></a>ContentChild</h3><p>用于配置内容查询的参数修饰器。</p>
<h4 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h4><p>用于从内容 DOM 获取与此选择器匹配的第一个元素或指令。如果内容 DOM 发生了更改，并且有一个新的子项与选择器匹配，则该属性将被更新。</p>
<p>在调用 <code>ngAfterContentInit</code> 之前设置的内容查询。</p>
<p>不检索其他组件模板中的元素或指令，因为组件模板对其祖先来说始终是黑匣子。</p>
<p><strong>元数据属性</strong>：</p>
<ul>
<li><strong>selector</strong> - 要查询的指令类型或名称。</li>
<li><strong>read</strong> - 用于从查询到的元素读取不同的令牌。</li>
<li><strong>static</strong> - 如果为 true，则在变更检测运行之前解析查询结果，如果为 false，则在变更检测之后解析。默认为 false。</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;Component, ContentChild, Directive, Input&#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Directive</span>(&#123;<span class="attr">selector</span>: <span class="string">&#x27;pane&#x27;</span>&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Pane</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Input</span>() id!: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">  selector: <span class="string">&#x27;tab&#x27;</span>,</span><br><span class="line">  template: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div&gt;pane: &#123;&#123;pane?.id&#125;&#125;&lt;/div&gt;</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Tab</span> </span>&#123;</span><br><span class="line">  <span class="meta">@ContentChild</span>(Pane) pane!: Pane;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">  selector: <span class="string">&#x27;example-app&#x27;</span>,</span><br><span class="line">  template: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;tab&gt;</span></span><br><span class="line"><span class="string">      &lt;pane id=&quot;1&quot; *ngIf=&quot;shouldShow&quot;&gt;&lt;/pane&gt;</span></span><br><span class="line"><span class="string">      &lt;pane id=&quot;2&quot; *ngIf=&quot;!shouldShow&quot;&gt;&lt;/pane&gt;</span></span><br><span class="line"><span class="string">    &lt;/tab&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &lt;button (click)=&quot;toggle()&quot;&gt;Toggle&lt;/button&gt;</span></span><br><span class="line"><span class="string">  `</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">ContentChildComp</span> </span>&#123;</span><br><span class="line">  shouldShow = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">toggle</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.shouldShow = !<span class="built_in">this</span>.shouldShow;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ElementRef"><a href="#ElementRef" class="headerlink" title="ElementRef"></a>ElementRef</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://angular.cn/api/core/ElementRef">https://angular.cn/api/core/ElementRef</a></p>
</blockquote>
<p>对视图中某个原生元素的包装器。它的背后是一个可渲染的具体元素，例如浏览器中通常为DOM元素。</p>
<p><img src="../post-images/image-20210322170031878.png" alt="image-20210322170031878"></p>
<h3 id=""><a href="#" class="headerlink" title=""></a></h3><h3 id="deepclone"><a href="#deepclone" class="headerlink" title="deepclone"></a>deepclone</h3><p>lodash的深拷贝方法是相对完善和严谨的，对于特殊的数据类型，环，兼容性等等都考虑到了。但是对于function类型，依然是引用。并且，也没有深拷贝在原型链上的属性。实现的方式主要是以Object.prototype.toString.call得到tag，再分类处理，环由stack解决，symbol由Object.getOwnPropertySymbols方法解决。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rickiewoo.github.io/2022/08/09/Vite%20%E5%AD%90%E5%BA%94%E7%94%A8%E6%8E%A5%E5%85%A5%20qiankun%20%EF%BC%88%E5%BE%AE%E5%89%8D%E7%AB%AF%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/sasuke.jpeg">
      <meta itemprop="name" content="Author">
      <meta itemprop="description" content="We were both young when I first saw you.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rickie Woo's Wonder Land">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/08/09/Vite%20%E5%AD%90%E5%BA%94%E7%94%A8%E6%8E%A5%E5%85%A5%20qiankun%20%EF%BC%88%E5%BE%AE%E5%89%8D%E7%AB%AF%EF%BC%89/" class="post-title-link" itemprop="url">Vite 子应用接入 qiankun （微前端）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-08-09 22:09:02" itemprop="dateCreated datePublished" datetime="2022-08-09T22:09:02+08:00">2022-08-09</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Trick/" itemprop="url" rel="index"><span itemprop="name">Trick</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Vite-子应用接入-qiankun-（微前端）"><a href="#Vite-子应用接入-qiankun-（微前端）" class="headerlink" title="Vite 子应用接入 qiankun （微前端）"></a>Vite 子应用接入 qiankun （微前端）</h1><p><strong>Vite 暂时没有作为微应用接入 QIANKUN 的官方教程，因此在这里给出 Vite 与 webpack 配置的不同之处</strong></p>
<p>官网配置<code>react</code>微应用地址： <a target="_blank" rel="noopener" href="https://qiankun.umijs.org/zh/guide/tutorial#react-%E5%BE%AE%E5%BA%94%E7%94%A8">https://qiankun.umijs.org/zh/guide/tutorial#react-%E5%BE%AE%E5%BA%94%E7%94%A8</a></p>
<ol>
<li>第一步：<em>不需要</em></li>
</ol>
<blockquote>
<p>在 <code>src</code> 目录新增 <code>public-path.js</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.__POWERED_BY_QIANKUN__) &#123;</span><br><span class="line">  __webpack_public_path__ = <span class="built_in">window</span>.__INJECTED_PUBLIC_PATH_BY_QIANKUN__;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<ol start="2">
<li>第二步：相同，根据主应用中的配置写路由，在我们的项目中使用的是<code>hash</code>路由，路径为<code>react</code></li>
</ol>
<blockquote>
<p>设置 <code>history</code> 模式路由的 <code>base</code>：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">BrowserRouter</span> <span class="attr">basename</span>=<span class="string">&#123;window.__POWERED_BY_QIANKUN__</span> ? &#x27;/<span class="attr">app-react</span>&#x27; <span class="attr">:</span> &#x27;/&#x27;&#125;&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 此处 Router 为 HashRouter</span><br><span class="line">&lt;Router basename&#x3D;&#123;window.__POWERED_BY_QIANKUN__ ? &#39;&#x2F;react&#39; : &#39;&#x2F;&#39;&#125;&gt;...&lt;&#x2F;Router&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>第三步：<em>少量不同</em></p>
<ol>
<li>我们的入口文件为 main.tsx，所以需要解决一些类型报错</li>
</ol>
<blockquote>
<p>入口文件 <code>index.js</code> 修改，为了避免根 id <code>#root</code> 与其他的 DOM 冲突，需要限制查找范围。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">declare global &#123;</span><br><span class="line">  interface Window &#123;</span><br><span class="line">    __POWERED_BY_QIANKUN__?: string;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">interface IRenderProps &#123;</span><br><span class="line">  container?: Element;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>其余配置跟官网一样</li>
</ol>
</li>
<li><p>第四步：<strong>完全不同，且看下面的配置</strong></p>
</li>
</ol>
<h2 id="如何配置-vite-config"><a href="#如何配置-vite-config" class="headerlink" title="如何配置 vite.config"></a>如何配置 vite.config</h2><h3 id="增加buildOption"><a href="#增加buildOption" class="headerlink" title="增加buildOption"></a>增加buildOption</h3><p><a target="_blank" rel="noopener" href="https://blog.techbridge.cc/2020/08/07/vite-and-esmodules-snowpack/">Vite 怎麼能那麼快？從 ES modules 開始談起</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.huli.tw/2020/01/21/webpack-newbie-tutorial/">webpack 新手教學之淺談模組化與 snowpack</a></p>
<p>目前<code>QIANKUN</code>不支持<code>vite</code>的主要原因是<code> QIANKUN</code>目前还不支持 <code>type=module</code>（<a target="_blank" rel="noopener" href="https://github.com/umijs/qiankun/issues/1257">https://github.com/umijs/qiankun/issues/1257</a></p>
<p>）</p>
<p>如果启动主应用和微应用，会看到<code>QIANKUN</code>报错，报错的地方就是<code>type=module</code>的地方。</p>
<p><img src="../post-images/image-20210415112126424.png" alt="image-20210415112126424"></p>
<p>而vite之所以是vite，最大的特点就是生产环境使用ESM，但是显然QIANKUN尚不支持，因此做了一个妥协方案：在打包的时候选择打包为lib，并将格式指定为umd。</p>
<p><em>注意：此处名称需要与主应用中 entry name 保持一致，而非官网中的 ${name}-[name]。否则会报错：生命周期的钩子函数没有暴露出来</em></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">build: &#123;</span><br><span class="line">  lib: &#123;</span><br><span class="line">    name: <span class="string">`<span class="subst">$&#123;name&#125;</span>`</span>,</span><br><span class="line">    entry: path.resolve(__dirname, <span class="string">&#x27;src/main.tsx&#x27;</span>), <span class="comment">// 这里 entry 是暴露出生命周期钩子的文件，本文中为main.tsx</span></span><br><span class="line">    formats: [<span class="string">&#x27;umd&#x27;</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配置完成后，build一下，如果出现报错： UMD and IIFE output formats are not supported for code-splitting builds.</p>
<p>则需将<code>rollup</code>的*<code>inlineDynamicImports</code>*打开</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rollupOptions: &#123;</span><br><span class="line">  output: &#123;</span><br><span class="line">    inlineDynamicImports: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>运行build之后，发现dist/中有两个文件 <code>style.css</code>,<code>*.umd.js</code>，但是没有<code>index.html</code></p>
<p>因此我们需要额外的工作——生成<code>index.html</code></p>
<h3 id="额外生成-index-html"><a href="#额外生成-index-html" class="headerlink" title="额外生成 index.html"></a>额外生成 index.html</h3><p>在我们的<code>src/index.html</code>中，可以看见</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">src</span>=<span class="string">&quot;/src/main.tsx&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>而在<code>dist/</code>文件中，我们希望</p>
<ul>
<li><p><code>script</code>改为生成的<code>umd.js</code>，并且<code>type=“text/javascript”</code></p>
</li>
<li><p>在<code>html</code>中引入生成的<code>style.css</code></p>
</li>
</ul>
<p>生成目标<code>index.html</code>的方式有很多种，在这里，我选择了使用<code>@rollup/plugin-html</code>插件来生成<code>html</code>。</p>
<p>考虑到希望生产环境的html出错的概率更小，所以把 <code>src/index.html</code> 修改为目标<code>index.html</code>，把修改<code>index</code>的操作放到开发环境中。</p>
<p>Index.html 修改如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">href</span>=<span class="string">&quot;style.css&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- build 出的 index.html 用这个 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">src</span>=<span class="string">&quot;$&#123;dist中js文件名称&#125;.umd.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">		...</span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>最终<code>vite.config.ts</code>配置如下</p>
<h2 id="vite-config-最终配置"><a href="#vite-config-最终配置" class="headerlink" title="vite.config 最终配置"></a>vite.config 最终配置</h2><h3 id="vite-config-ts"><a href="#vite-config-ts" class="headerlink" title="vite.config.ts"></a>vite.config.ts</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* eslint-disable @typescript-eslint/restrict-template-expressions */</span></span><br><span class="line"><span class="comment">/* eslint-disable @typescript-eslint/no-require-imports */</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> reactRefresh <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-react-refresh&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; buildHtmlPlugin, serveHtmlPlugin &#125; <span class="keyword">from</span> <span class="string">&#x27;./html-plugin&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; name &#125; = <span class="built_in">require</span>(<span class="string">&#x27;./package.json&#x27;</span>);</span><br><span class="line"><span class="comment">// https://vitejs.dev/config/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineConfig(&#123;</span><br><span class="line">  base: <span class="string">&#x27;./&#x27;</span>,</span><br><span class="line">  <span class="comment">// HACK for qiankun: 为 lib 生成 html</span></span><br><span class="line">  plugins: [reactRefresh(), buildHtmlPlugin(), serveHtmlPlugin()],</span><br><span class="line">  build: &#123;</span><br><span class="line">    target: <span class="string">&#x27;esnext&#x27;</span>,</span><br><span class="line">    lib: &#123;</span><br><span class="line">      name: <span class="string">`<span class="subst">$&#123;name&#125;</span>`</span>,</span><br><span class="line">      entry: path.resolve(__dirname, <span class="string">&#x27;src/main.tsx&#x27;</span>),</span><br><span class="line">      formats: [<span class="string">&#x27;umd&#x27;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">    rollupOptions: &#123;</span><br><span class="line">      output: &#123;</span><br><span class="line">        inlineDynamicImports: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="html-plugin-ts"><a href="#html-plugin-ts" class="headerlink" title="html-plugin.ts"></a>html-plugin.ts</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> html = <span class="built_in">require</span>(<span class="string">&#x27;@rollup/plugin-html&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> indexHtmlContent = fs?.readFileSync(<span class="string">&#x27;./index.html&#x27;</span>)?.toString();</span><br><span class="line"><span class="built_in">enum</span> applyType &#123;</span><br><span class="line">  <span class="string">&#x27;serve&#x27;</span> = <span class="string">&#x27;serve&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;build&#x27;</span> = <span class="string">&#x27;build&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> serveHtmlPlugin = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    name: <span class="string">&#x27;generate html for developer&#x27;</span>,</span><br><span class="line">    apply: applyType.serve,</span><br><span class="line">    <span class="function"><span class="title">transformIndexHtml</span>(<span class="params">indexHtml: <span class="built_in">string</span></span>)</span> &#123;</span><br><span class="line">      <span class="comment">// 将 index.html 中的 script 换成 main.tsx，同时不使用 style.css 的样式（因为dev环境下没有生成）</span></span><br><span class="line">      <span class="keyword">return</span> indexHtml</span><br><span class="line">        .replace(<span class="string">`type=&quot;text/javascript&quot;`</span>, <span class="string">`type=&quot;module&quot;`</span>)</span><br><span class="line">        .replace(<span class="string">`src=&quot;<span class="subst">$&#123;dist中js文件名称&#125;</span>.umd.js&quot;`</span>, <span class="string">`src=&quot;/src/main.tsx&quot;&quot;`</span>)</span><br><span class="line">        .replace(<span class="string">`href=&quot;style.css&quot;`</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> buildHtmlPlugin = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ...html(&#123;</span><br><span class="line">      template: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!indexHtmlContent?.length) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;没有找到 index.html 文件&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> indexHtmlContent;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">    name: <span class="string">&#x27;generate html for production&#x27;</span>,</span><br><span class="line">    apply: applyType.build,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><p> 加了两个npm脚本</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;qiankun:preview&quot;: &quot;cd dist/ &amp;&amp; http-server -p=8080 --cors&quot;,</span><br><span class="line">&quot;qiankun:rebuild&quot;: &quot;npm run build:test &amp;&amp; npm run qiankun:preview&quot;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>需要运行</p>
<ul>
<li>（未打包）npm run qiankun:rebuild</li>
<li>（已打包）npm run qiankun:preview</li>
</ul>
</li>
<li><p>启动 微前端主应用，保证主应用中 local 模式下<code>entry</code>端口号与上面一致</p>
</li>
<li><p>访问对应的地址（如 <a target="_blank" rel="noopener" href="http://localhost:8427/#/react%EF%BC%89%EF%BC%8C%E6%9F%A5%E7%9C%8B%E6%98%AF%E5%90%A6%E8%83%BD%E6%AD%A3%E5%B8%B8%E6%98%BE%E7%A4%BA">http://localhost:8427/#/react），查看是否能正常显示</a></p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rickiewoo.github.io/2022/08/09/Scratch%20%E5%88%9D%E5%A7%8B%E5%8C%96%E6%B5%81%E7%A8%8B%E5%9B%BE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/sasuke.jpeg">
      <meta itemprop="name" content="Author">
      <meta itemprop="description" content="We were both young when I first saw you.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rickie Woo's Wonder Land">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/08/09/Scratch%20%E5%88%9D%E5%A7%8B%E5%8C%96%E6%B5%81%E7%A8%8B%E5%9B%BE/" class="post-title-link" itemprop="url">Scratch 初始化流程图</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-08-09 22:09:02" itemprop="dateCreated datePublished" datetime="2022-08-09T22:09:02+08:00">2022-08-09</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/keep-learning/" itemprop="url" rel="index"><span itemprop="name">keep-learning</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Scratch-初始化流程图"><a href="#Scratch-初始化流程图" class="headerlink" title="Scratch 初始化流程图"></a>Scratch 初始化流程图</h1><p>![Map 1](../post-images/Map 1.png)</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rickiewoo.github.io/2021/04/13/%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E5%AF%B9%E6%AF%94/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/sasuke.jpeg">
      <meta itemprop="name" content="Author">
      <meta itemprop="description" content="We were both young when I first saw you.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rickie Woo's Wonder Land">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/13/%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E5%AF%B9%E6%AF%94/" class="post-title-link" itemprop="url">状态管理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-04-13 11:03:26" itemprop="dateCreated datePublished" datetime="2021-04-13T11:03:26+08:00">2021-04-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-04-16 16:12:23" itemprop="dateModified" datetime="2021-04-16T16:12:23+08:00">2021-04-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/keep-learning/" itemprop="url" rel="index"><span itemprop="name">keep-learning</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="状态管理"><a href="#状态管理" class="headerlink" title="状态管理"></a>状态管理</h1><p><a target="_blank" rel="noopener" href="https://daveceddia.com/react-state-management/">https://daveceddia.com/react-state-management/</a></p>
<h2 id="Redux"><a href="#Redux" class="headerlink" title="Redux"></a>Redux</h2><p>通常与React捆绑在一起，但是其核心是<strong>独立的</strong>，因此可以与任何UI库或框架一起使用。</p>
<ul>
<li>缺点：<ul>
<li>陡峭的学习曲线</li>
<li>冗长的 action 到 reducer  的过程（严重依赖不变性）</li>
</ul>
</li>
<li>优点<ul>
<li>最大的社区和生态系统</li>
<li>官方<a target="_blank" rel="noopener" href="https://redux-toolkit.js.org/">Redux Toolkit</a>库减少了样板代码</li>
<li>size</li>
<li>Time travel debugging</li>
<li>拥有自己的库生态系统，可用于执行与本地存储同步，管理API请求等操作</li>
<li>出色的devtools使调试变得简单</li>
</ul>
</li>
</ul>
<h2 id="MobX"><a href="#MobX" class="headerlink" title="MobX"></a>MobX</h2><p><strong>MobX</strong>是一个非常流行的，<strong>包含电池？的</strong>状态管理库，主要（但非专门）用于React。</p>
<p>MobX无疑是 <a target="_blank" rel="noopener" href="https://bundlephobia.com/result?p=mobx">不小的 lib</a>，但是与Redux相比，有些人可能会发现它的API和<strong>可观察的方法</strong>更令人愉悦。这种库仍然有一个明显的学习曲线，但是在那之后，它确实比传统的Redux感觉更好并且<strong>没有重复性</strong>。</p>
<p>MobX的API很好，并且可以生成一些非常漂亮和干净的代码，但是深层来说，它是一个沉重的库，很难完全掌握。最重要的是，它会带来一个明显更小的社区和生态系统。</p>
<hr>
<p>MobX基于观察者/可观察模式。创建一个可观察的数据模型，将组件标记为该数据的“观察者”，MobX将自动跟踪它们访问的数据，并在更改时重新呈现它们。</p>
<p>使用者可以随意定义自己认为合适的数据模型，并提供监视模型变化、并对这些变化做出反应的工具。</p>
<p>MobX的背后是使用ES6代理来检测更改，因此更新可观察数据就像使用普通的旧赋值运算符<code>=</code>一样容易。</p>
<ul>
<li><p>优点</p>
<ul>
<li>以一种真正的“反应式”方式管理状态，以便在您修改值时，使用该值的所有组件都将自动重新呈现</li>
<li>无需进行任何操作或减速器，只需修改您的状态，应用程序便会反映出来。</li>
<li>神奇的反应性意味着更少的代码编写。</li>
<li>您可以编写常规的可变代码。无需特殊的设置器功能或不变性。</li>
</ul>
</li>
<li><p>缺点</p>
<ul>
<li>由于没有Redux广泛使用，因此社区支持（教程等）较少，但是受到用户的喜爱</li>
<li>神奇的反应性意味着不太明确的代码。（根据您对自动更新“魔术”的感觉，这可能是赞成也可能是反对）</li>
<li>对ES6代理的要求意味着不支持IE11及以下版本。（如果您的应用程序要求支持IE，则较旧版本的MobX无需代理即可工作）</li>
</ul>
</li>
</ul>
<h2 id="Recoil"><a href="#Recoil" class="headerlink" title="Recoil"></a>Recoil</h2><p><a target="_blank" rel="noopener" href="https://www.recoiljs.cn/docs/introduction/getting-started">https://www.recoiljs.cn/docs/introduction/getting-started</a></p>
<blockquote>
<p><strong>Recoil</strong>作为<em>“ Facebook实验”</em>，它在今年年初处于<strong>不稳定阶段</strong>“启动”时获得了很大的吸引力。</p>
<p>现代<strong>的基于原子的</strong>状态管理方法和<strong>以钩子为中心的</strong>流畅<strong>API</strong>确实使它颇具吸引力。</p>
<p>但是，由于Recoil的试验阶段，现在建议不要在生产级项目中使用它。</p>
</blockquote>
<p>API就像是React的useState和Context API的组合，因此感觉与React非常相似。</p>
<p>要使用它，您可以将组件树包装为<code>RecoilRoot</code>（类似于使用自己的Context Provider的方式）。然后在顶层创建状态的“atom”，每个原子都有一个唯一的键。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> currentLanguage = atom(&#123;</span><br><span class="line">  key: <span class="string">&#x27;currentLanguage&#x27;</span>,</span><br><span class="line">  <span class="keyword">default</span>: <span class="string">&#x27;en&#x27;</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>然后，组件可以使用<code>useRecoilState</code>钩子访问此状态，该钩子的工作方式非常类似于<code>useState</code>：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">LanguageSelector</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [language, setLanguage] = useRecoilState(currentLanguage);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;Languauge is &#123;language&#125;&lt;/div&gt;</span><br><span class="line">    &lt;button onClick=&#123;<span class="function">() =&gt;</span> setLanguage(<span class="string">&#x27;es&#x27;</span>)&#125;&gt;</span><br><span class="line">      Switch to Español</span><br><span class="line">    &lt;/button&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>还有一个“selectors”的概念，可让您创建一个原子视图：想到<em>派生</em>状态，例如“将TODO列表过滤为已完成的状态”。</p>
<p>通过跟踪对的调用<code>useRecoilState</code>，Recoil可以跟踪哪些组件使用哪些原子。这样，它可以<em>仅</em>在数据更改时<em>仅</em>重新呈现“订阅”到数据的组件，因此该方法应在性能方面很好地扩展。</p>
<h4 id="好处"><a href="#好处" class="headerlink" title="好处"></a>好处</h4><ul>
<li>与React非常相似的简单API</li>
<li>Facebook在其一些内部工具中使用了它</li>
<li>专为性能而设计</li>
<li>在有或没有React Suspense的情况下均可使用（虽然仍处于试验阶段）</li>
</ul>
<h4 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h4><ul>
<li>只有几个月的历史，因此社区资源和最佳实践还不如其他库强大。</li>
</ul>
<h2 id="Akita？"><a href="#Akita？" class="headerlink" title="Akita？"></a>Akita？</h2><p>基于类的组件比较合适</p>
<p>是面向对象的API</p>
<h2 id="HookStat"><a href="#HookStat" class="headerlink" title="HookStat"></a>HookStat</h2><p>它体积小，最小，干净，可扩展，并且具有一个漂亮<strong>的基于钩子的API</strong>。</p>
<p>它不仅可以用于全局状态，还可以通过附加功能增强本地<code>useState（）</code>，在不影响性能的情况下处理<strong>嵌套状态</strong>，并轻松处理<strong>异步数据</strong>！</p>
<h3 id="useStat什么时候not-enough"><a href="#useStat什么时候not-enough" class="headerlink" title="useStat什么时候not enough"></a>useStat什么时候not enough</h3><p>该<a target="_blank" rel="noopener" href="https://daveceddia.com/usestate-hook-examples/">useState钩</a>非常适合少量llocal组件状态。每个<code>useState</code>调用可以包含一个值，虽然您<em>可以</em>使一个值成为包含许多其他值的对象，但是最好将它们拆分。</p>
<p>一旦您<code>useState</code>在一个组件中遇到3-5次调用，事情就可能变得难以跟踪。<em>尤其是</em>那些状态位彼此依赖时。对于复杂的相互依赖关系，适当的<a target="_blank" rel="noopener" href="https://daveceddia.com/react-confirmation-modal-state-machine/">状态机</a>可能是更好的选择。</p>
<h3 id="next，-useReducer：-中度复杂的React组件状态管理"><a href="#next，-useReducer：-中度复杂的React组件状态管理" class="headerlink" title="next， useReducer： 中度复杂的React组件状态管理"></a>next， useReducer： 中度复杂的React组件状态管理</h3><p>useState的下一步“向上”是<code>useReducer</code>。reducer提供了一个集中的位置，可以拦截“action”并相应地更新状态。像这样的调用<code>useState</code>只能保存一个值，但是更为普遍的是使用<code>useReducer</code>处理一个包含多个值的对象。</p>
<h3 id="useContext-将值传递给子组件而不用层层钻"><a href="#useContext-将值传递给子组件而不用层层钻" class="headerlink" title="useContext : 将值传递给子组件而不用层层钻"></a>useContext : 将值传递给子组件而不用层层钻</h3><p>除了<code>useState</code>和<code>useReducer</code>，另一个痛点是：当您拥有一个拥有某种状态的组件，然后需要向下访问5个子组件的状态时，您必须手动钻取每个级别的子组件。</p>
<p>这里最简单的解决方案是Context API。它内置在React中。</p>
<p>尽管它很简单，但是Context有一个重要的缺点，那就是性能，因此要小心使用。</p>
<p>原因是<code>useContext</code>当提供者的<code>value</code>属性更改时，调用的每个组件都会重新呈现。设想如果该值是一个对象，该对象包含整个应用程序中使用的50个不同的状态位，将会发生什么。而且它们经常且独立地变化。这些值<em>之一</em>每次更改时，使用其中<em>任何</em>一个的每个组件都会重新呈现。</p>
<p><strong>为了避免这种陷阱，请在每个上下文中存储一小部分相关数据，然后将数据拆分到多个上下文中（您可以根据需要拥有尽可能多的数据）。或者，考虑使用第三方库。</strong></p>
<p>另一个要避免的性能陷阱是<code>value</code>，每次都将一个新的对象传递给提供程序的对象。 比如 <code>value = &#123; aProp &#125;</code>,每次渲染都会重新创建包裹<code>aProp</code>的对象。</p>
<h3 id="结合Redux"><a href="#结合Redux" class="headerlink" title="结合Redux"></a>结合Redux</h3><p><strong>您可以同时使用Redux和Context，并且可以<code>useReducer</code>一起使用！</strong> 我们特别鼓励<a target="_blank" rel="noopener" href="https://redux.js.org/tutorials/essentials/part-2-app-structure#component-state-and-forms">在Redux中放置“全局状态”，在React组件中放置“本地状态”</a>，并<a target="_blank" rel="noopener" href="https://redux.js.org/style-guide/style-guide#evaluate-where-each-piece-of-state-should-live">仔细决定每个状态应该处于Redux还是组件状态</a>。因此，您可以<code>useReducer</code>在同一应用程序中同时将Redux用于全局的某些状态，将+ Context用于更局部的状态，将Context本身用于某些半静态值。</p>
<p><a target="_blank" rel="noopener" href="https://blog.isquaredsoftware.com/2021/01/context-redux-differences/">了解Context与Redux的不同之处</a></p>
<h2 id="Dova-。。。"><a href="#Dova-。。。" class="headerlink" title="Dova 。。。"></a>Dova 。。。</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rickiewoo.github.io/2021/03/29/Flux/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/sasuke.jpeg">
      <meta itemprop="name" content="Author">
      <meta itemprop="description" content="We were both young when I first saw you.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rickie Woo's Wonder Land">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/29/Flux/" class="post-title-link" itemprop="url">Flux学习笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-03-29 10:39:57" itemprop="dateCreated datePublished" datetime="2021-03-29T10:39:57+08:00">2021-03-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-04-16 16:18:25" itemprop="dateModified" datetime="2021-04-16T16:18:25+08:00">2021-04-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/keep-learning/" itemprop="url" rel="index"><span itemprop="name">keep-learning</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Flux"><a href="#Flux" class="headerlink" title="Flux"></a>Flux</h1><p>##concepts</p>
<p><img src="https://github.com/facebook/flux/raw/master/examples/flux-concepts/flux-simple-f8-diagram-with-client-action-1300w.png" alt="Data flow within Flux application"></p>
<p>Flux是一种管理应用中数据流的模式。最重要的观点是单向数据流。</p>
<p>Flux由Dispatcher、store、view、action构成</p>
<h3 id="Dispatcher"><a href="#Dispatcher" class="headerlink" title="Dispatcher"></a>Dispatcher</h3><p><code>dispatcher</code>接收<code>action</code>并把它们派发给已经在<code>disipatcher</code>中注册过的<code>store</code>。**每一个<code>store</code>都会收到所有<code>action</code>**。在每一个应用中应该只有一个单例<code>dispatcher</code>.</p>
<h3 id="Store"><a href="#Store" class="headerlink" title="Store"></a>Store</h3><p><code>store</code>存储了一个应用的数据。<code>store</code>通过注册到应用程序的<code>dispatcher</code>上接受<code>action</code>。一个<code>store</code>中的所有数据都只能因为响应行为发生变化。在一个<code>store</code>中只能有<code>getter</code>，不能有任何<code>public setter</code>，<code>store</code>决定了他们要响应什么<code>action</code>，每次一个<code>store</code>的数据变化必须<code>emit</code>一个<code>change event</code>。在一个应用程序中会有多个<code>store</code></p>
<h3 id="Actions"><a href="#Actions" class="headerlink" title="Actions"></a>Actions</h3><p>Actions 定义了应用程序内部的API，他们捕获应用程序内所有的交互，他们是简单的包含type字段和一些数据的对象</p>
<p>Actions应该是语义化的，描述所发生的action，但是不应该描述该action的实现细节。使用“删除用户”而不是将其分解为“删除用户ID”，“清除用户数据”，“刷新凭证”（或者该过程有效）。请记住，所有存储都将收到该操作，并且可以知道它们需要通过处理相同的“删除用户”操作来清除数据或刷新凭据。</p>
<h3 id="Views"><a href="#Views" class="headerlink" title="Views"></a>Views</h3><p>store中的数据会被称现在view追踪，views可以使用任何框架，例如react。当一个view使用了来自某个store的数据，他必须订阅来自那个store的change事件。然后当store出发一个change事件时，view可以得到新的数据并重新渲染。如果一个组件使用了一个store，但是并没有订阅，很可能会有细微的错误。当用户与应用程序界面的各个部分进行交互时，通常会从视图view中调度action。</p>
<h3 id="数据流"><a href="#数据流" class="headerlink" title="数据流"></a>数据流</h3><ol>
<li>view发送action到dsipatcher</li>
<li>dispatcher发送action到每一个store</li>
<li>store发送数据到view</li>
</ol>
<p>（是store主动发送数据到view，而不是view从store获取数据）</p>
<h2 id="flux-async"><a href="#flux-async" class="headerlink" title="flux-async"></a>flux-async</h2><h3 id="DataManager"><a href="#DataManager" class="headerlink" title="DataManager"></a>DataManager</h3><p>DataManagers是flex中服务器痛心的方法，DataManagers将入参转化为action，作为结果的action应始终被异步调度，这样可以在调度该action的之前留出API请求的时间。</p>
<p>DataManagers只应该被store调用。</p>
<p>TODO</p>
<ul>
<li>flux的缺点<ul>
<li>多个store有什么优缺点</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rickiewoo.github.io/2021/02/20/%E5%BC%82%E6%AD%A5%E6%B5%81%20async%20%E6%97%B6%EF%BC%8C%E5%BE%97%E5%88%B0%20null%20%E7%9A%84bug/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/sasuke.jpeg">
      <meta itemprop="name" content="Author">
      <meta itemprop="description" content="We were both young when I first saw you.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rickie Woo's Wonder Land">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/20/%E5%BC%82%E6%AD%A5%E6%B5%81%20async%20%E6%97%B6%EF%BC%8C%E5%BE%97%E5%88%B0%20null%20%E7%9A%84bug/" class="post-title-link" itemprop="url">异步流 async 时，得到 null 的bug</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-02-20 11:45:13" itemprop="dateCreated datePublished" datetime="2021-02-20T11:45:13+08:00">2021-02-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-04-16 16:12:31" itemprop="dateModified" datetime="2021-04-16T16:12:31+08:00">2021-04-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/note/" itemprop="url" rel="index"><span itemprop="name">note</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="问题："><a href="#问题：" class="headerlink" title="问题："></a>问题：</h2><p>假设模版代码中使用了asyncPipe：</p>
<p>  obs$ | async</p>
<p>如果obs$是一个异步得到的值，例如请求、delay等<br>那么obs$ | async得到的值为 null，等请求返回、或者到达指定时间时才会返回订阅结果</p>
<h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- *.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">app-component</span> [<span class="attr">input</span>]=<span class="string">&quot;asyncObservable$ | async&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">app-component</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// *.ts</span></span><br><span class="line"><span class="meta">@Input</span>() <span class="keyword">set</span> <span class="title">input</span>(<span class="params">input: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">  <span class="comment">// 如果不加判断，则在得到正确的值前，会先有 this.input$.next(null)</span></span><br><span class="line">  <span class="keyword">if</span> (input !== <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>.input$.next(input)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">input$ = <span class="keyword">new</span> ReplaySubject&lt;<span class="built_in">any</span>&gt;(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<h2 id="关于asyncPipe"><a href="#关于asyncPipe" class="headerlink" title="关于asyncPipe"></a>关于asyncPipe</h2><p>asyncPipe源码解析：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/qianxiaox/p/13750539.html">https://www.cnblogs.com/qianxiaox/p/13750539.html</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rickiewoo.github.io/2021/02/20/Angular-%E5%8E%BB%E9%99%A4%E7%BB%84%E4%BB%B6%E6%A0%87%E7%AD%BE%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/sasuke.jpeg">
      <meta itemprop="name" content="Author">
      <meta itemprop="description" content="We were both young when I first saw you.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rickie Woo's Wonder Land">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/20/Angular-%E5%8E%BB%E9%99%A4%E7%BB%84%E4%BB%B6%E6%A0%87%E7%AD%BE%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" class="post-title-link" itemprop="url">Angular-去除组件标签的解决方案</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-02-20 11:44:35" itemprop="dateCreated datePublished" datetime="2021-02-20T11:44:35+08:00">2021-02-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-04-16 16:12:19" itemprop="dateModified" datetime="2021-04-16T16:12:19+08:00">2021-04-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/note/" itemprop="url" rel="index"><span itemprop="name">note</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>做老师带多科需求的时候，需要更改各个列表的table header的filter，改动基本一致。</p>
<p>之前每个table的<th>都是写在各自组件的，因为写在组件中，最外层会有个<app-xxx>的标签，会打乱<tr>中的样式。而现在我们不得不将一部分<th>组件抽出来。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>参见 conan-cat-web 中的 <table-header> 组件</p>
<p>createEmbeddedView + style=”display: none”</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// table-header.ts</span></span><br><span class="line"><span class="meta">@ViewChild</span>(<span class="string">&#x27;tableHeader&#x27;</span>, &#123; <span class="attr">static</span>: <span class="literal">true</span> &#125;) tableHeaderTpl!: TemplateRef&lt;unknown&gt;;</span><br><span class="line"></span><br><span class="line"><span class="title">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">    <span class="keyword">private</span> viewContainerRef: ViewContainerRef,</span></span><br><span class="line"><span class="params">  </span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">ngOnInit</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.viewContainerRef.createEmbeddedView(<span class="built_in">this</span>.tableHeaderTpl);</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- table-header.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ng-template</span> #<span class="attr">tableHeader</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">th</span> *<span class="attr">ngFor</span>=<span class="string">&quot;let item of data&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ng-template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* style.css */</span></span><br><span class="line"><span class="comment">/* 删除 app-table-header 标签 */</span></span><br><span class="line">app-<span class="selector-tag">table</span>-<span class="selector-tag">header</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>: non</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Author"
      src="/images/sasuke.jpeg">
  <p class="site-author-name" itemprop="name">Author</p>
  <div class="site-description" itemprop="description">We were both young when I first saw you.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">46</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">29</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/rickiewoo" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;rickiewoo" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:rickiemeow@gmail.com" title="E-Mail → mailto:rickiemeow@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://plus.google.com/rickiewoo" title="Google → https:&#x2F;&#x2F;plus.google.com&#x2F;rickiewoo" rel="noopener" target="_blank"><i class="fab fa-google fa-fw"></i>Google</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/3296105801" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;3296105801" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">the way you played with me like a child</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>

<script src="/js/utils.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
