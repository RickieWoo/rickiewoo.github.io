<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/160.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/160.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/160.jpg">
  <link rel="mask-icon" href="/images/160.jpg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"rickiewoo.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="We were both young when I first saw you.">
<meta property="og:type" content="website">
<meta property="og:title" content="Rickie Woo&#39;s Wonder Land">
<meta property="og:url" content="http://rickiewoo.github.io/index.html">
<meta property="og:site_name" content="Rickie Woo&#39;s Wonder Land">
<meta property="og:description" content="We were both young when I first saw you.">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Rickie Woo">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://rickiewoo.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Rickie Woo's Wonder Land</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta custom-logo">
      <div class="site-meta-headline">
        <a>
          <img class="custom-logo-image" src="/images/logo.png" alt="Rickie Woo's Wonder Land">
        </a>
      </div>

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Rickie Woo's Wonder Land</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Why is a raven like a writing-desk?</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>Schedule</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rickiewoo.github.io/2021/04/14/Vite%20%E5%AD%90%E5%BA%94%E7%94%A8%E6%8E%A5%E5%85%A5%20qiankun%20%EF%BC%88%E5%BE%AE%E5%89%8D%E7%AB%AF%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/sasuke.jpeg">
      <meta itemprop="name" content="Rickie Woo">
      <meta itemprop="description" content="We were both young when I first saw you.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rickie Woo's Wonder Land">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/14/Vite%20%E5%AD%90%E5%BA%94%E7%94%A8%E6%8E%A5%E5%85%A5%20qiankun%20%EF%BC%88%E5%BE%AE%E5%89%8D%E7%AB%AF%EF%BC%89/" class="post-title-link" itemprop="url">Vite 子应用接入 qiankun （微前端）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-04-14 18:38:58" itemprop="dateCreated datePublished" datetime="2021-04-14T18:38:58+08:00">2021-04-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-04-15 16:50:40" itemprop="dateModified" datetime="2021-04-15T16:50:40+08:00">2021-04-15</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Vite-子应用接入-qiankun-（微前端）"><a href="#Vite-子应用接入-qiankun-（微前端）" class="headerlink" title="Vite 子应用接入 qiankun （微前端）"></a>Vite 子应用接入 qiankun （微前端）</h1><p><strong>Vite 暂时没有作为微应用接入 QIANKUN 的官方教程，因此在这里给出 Vite 与 webpack 配置的不同之处</strong></p>
<p>官网配置<code>react</code>微应用地址： <a href="https://qiankun.umijs.org/zh/guide/tutorial#react-%E5%BE%AE%E5%BA%94%E7%94%A8" target="_blank" rel="noopener">https://qiankun.umijs.org/zh/guide/tutorial#react-%E5%BE%AE%E5%BA%94%E7%94%A8</a></p>
<ol>
<li>第一步：<em>不需要</em></li>
</ol>
<blockquote>
<p>在 <code>src</code> 目录新增 <code>public-path.js</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.__POWERED_BY_QIANKUN__) &#123;</span><br><span class="line">  __webpack_public_path__ = <span class="built_in">window</span>.__INJECTED_PUBLIC_PATH_BY_QIANKUN__;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<ol start="2">
<li>第二步：相同，根据主应用中的配置写路由，在我们的项目中使用的是<code>hash</code>路由，路径为<code>react</code></li>
</ol>
<blockquote>
<p>设置 <code>history</code> 模式路由的 <code>base</code>：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">BrowserRouter</span> <span class="attr">basename</span>=<span class="string">&#123;window.__POWERED_BY_QIANKUN__</span> ? '/<span class="attr">app-react</span>' <span class="attr">:</span> '/'&#125;&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 此处 Router 为 HashRouter</span><br><span class="line">&lt;Router basename&#x3D;&#123;window.__POWERED_BY_QIANKUN__ ? &#39;&#x2F;react&#39; : &#39;&#x2F;&#39;&#125;&gt;...&lt;&#x2F;Router&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>第三步：<em>少量不同</em></p>
<ol>
<li>我们的入口文件为 main.tsx，所以需要解决一些类型报错</li>
</ol>
<blockquote>
<p>入口文件 <code>index.js</code> 修改，为了避免根 id <code>#root</code> 与其他的 DOM 冲突，需要限制查找范围。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">declare global &#123;</span><br><span class="line">  interface Window &#123;</span><br><span class="line">    __POWERED_BY_QIANKUN__?: string;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">interface IRenderProps &#123;</span><br><span class="line">  container?: Element;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>其余配置跟官网一样</li>
</ol>
</li>
<li><p>第四步：<strong>完全不同，且看下面的配置</strong></p>
</li>
</ol>
<h2 id="如何配置-vite-config"><a href="#如何配置-vite-config" class="headerlink" title="如何配置 vite.config"></a>如何配置 vite.config</h2><h3 id="增加buildOption"><a href="#增加buildOption" class="headerlink" title="增加buildOption"></a>增加buildOption</h3><p><a href="https://blog.techbridge.cc/2020/08/07/vite-and-esmodules-snowpack/" target="_blank" rel="noopener">Vite 怎麼能那麼快？從 ES modules 開始談起</a></p>
<p><a href="https://blog.huli.tw/2020/01/21/webpack-newbie-tutorial/" target="_blank" rel="noopener">webpack 新手教學之淺談模組化與 snowpack</a></p>
<p>目前<code>QIANKUN</code>不支持<code>vite</code>的主要原因是<code>QIANKUN</code>目前还不支持 <code>type=module</code>（<a href="https://github.com/umijs/qiankun/issues/1257" target="_blank" rel="noopener">https://github.com/umijs/qiankun/issues/1257</a></p>
<p>）</p>
<p>如果启动主应用和微应用，会看到<code>QIANKUN</code>报错，报错的地方就是<code>type=module</code>的地方。</p>
<p>![image-20210415112126424](/Users/rickie/Library/Application Support/typora-user-images/image-20210415112126424.png)</p>
<p>而vite之所以是vite，最大的特点就是生产环境使用ESM，但是显然QIANKUN尚不支持，因此做了一个妥协方案：在打包的时候选择打包为lib，并将格式指定为umd。</p>
<p><em>注意：此处名称需要与主应用中 entry name 保持一致，而非官网中的 ${name}-[name]。否则会报错：生命周期的钩子函数没有暴露出来</em></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">build: &#123;</span><br><span class="line">  lib: &#123;</span><br><span class="line">    name: <span class="string">`<span class="subst">$&#123;name&#125;</span>`</span>, </span><br><span class="line">    entry: path.resolve(__dirname, <span class="string">'src/main.tsx'</span>), <span class="comment">// 这里 entry 是暴露出生命周期钩子的文件，本文中为main.tsx</span></span><br><span class="line">    formats: [<span class="string">'umd'</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配置完成后，build一下，如果出现报错： UMD and IIFE output formats are not supported for code-splitting builds.</p>
<p>则需将<code>rollup</code>的<em><code>inlineDynamicImports</code></em>打开</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rollupOptions: &#123;</span><br><span class="line">  output: &#123;</span><br><span class="line">    inlineDynamicImports: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>运行build之后，发现dist/中有两个文件 <code>style.css</code>,<code>*.umd.js</code>，但是没有<code>index.html</code></p>
<p>因此我们需要额外的工作——生成<code>index.html</code></p>
<h3 id="额外生成-index-html"><a href="#额外生成-index-html" class="headerlink" title="额外生成 index.html"></a>额外生成 index.html</h3><p>在我们的<code>src/index.html</code>中，可以看见</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"root"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"module"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">src</span>=<span class="string">"/src/main.tsx"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>而在<code>dist/</code>文件中，我们希望</p>
<ul>
<li><p><code>script</code>改为生成的<code>umd.js</code>，并且<code>type=“text/javascript”</code></p>
</li>
<li><p>在<code>html</code>中引入生成的<code>style.css</code></p>
</li>
</ul>
<p>生成目标<code>index.html</code>的方式有很多种，在这里，我选择了使用<code>@rollup/plugin-html</code>插件来生成<code>html</code>。</p>
<p>考虑到希望生产环境的html出错的概率更小，所以把 <code>src/index.html</code> 修改为目标<code>index.html</code>，把修改<code>index</code>的操作放到开发环境中。</p>
<p>Index.html 修改如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">type</span>=<span class="string">"text/css"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">href</span>=<span class="string">"style.css"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"root"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- build 出的 index.html 用这个 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">src</span>=<span class="string">"$&#123;dist中js文件名称&#125;.umd.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">		...</span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>最终<code>vite.config.ts</code>配置如下</p>
<h2 id="vite-config-最终配置"><a href="#vite-config-最终配置" class="headerlink" title="vite.config 最终配置"></a>vite.config 最终配置</h2><h3 id="vite-config-ts"><a href="#vite-config-ts" class="headerlink" title="vite.config.ts"></a>vite.config.ts</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* eslint-disable @typescript-eslint/restrict-template-expressions */</span></span><br><span class="line"><span class="comment">/* eslint-disable @typescript-eslint/no-require-imports */</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">'vite'</span>;</span><br><span class="line"><span class="keyword">import</span> reactRefresh <span class="keyword">from</span> <span class="string">'@vitejs/plugin-react-refresh'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; buildHtmlPlugin, serveHtmlPlugin &#125; <span class="keyword">from</span> <span class="string">'./html-plugin'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; name &#125; = <span class="built_in">require</span>(<span class="string">'./package.json'</span>);</span><br><span class="line"><span class="comment">// https://vitejs.dev/config/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineConfig(&#123;</span><br><span class="line">  base: <span class="string">'./'</span>,</span><br><span class="line">  <span class="comment">// HACK for qiankun: 为 lib 生成 html</span></span><br><span class="line">  plugins: [reactRefresh(), buildHtmlPlugin(), serveHtmlPlugin()],</span><br><span class="line">  build: &#123;</span><br><span class="line">    target: <span class="string">'esnext'</span>,</span><br><span class="line">    lib: &#123;</span><br><span class="line">      name: <span class="string">`<span class="subst">$&#123;name&#125;</span>`</span>,</span><br><span class="line">      entry: path.resolve(__dirname, <span class="string">'src/main.tsx'</span>),</span><br><span class="line">      formats: [<span class="string">'umd'</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">    rollupOptions: &#123;</span><br><span class="line">      output: &#123;</span><br><span class="line">        inlineDynamicImports: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="html-plugin-ts"><a href="#html-plugin-ts" class="headerlink" title="html-plugin.ts"></a>html-plugin.ts</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> html = <span class="built_in">require</span>(<span class="string">'@rollup/plugin-html'</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> indexHtmlContent = fs?.readFileSync(<span class="string">'./index.html'</span>)?.toString();</span><br><span class="line"><span class="keyword">enum</span> applyType &#123;</span><br><span class="line">  <span class="string">'serve'</span> = <span class="string">'serve'</span>,</span><br><span class="line">  <span class="string">'build'</span> = <span class="string">'build'</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> serveHtmlPlugin = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    name: <span class="string">'generate html for developer'</span>,</span><br><span class="line">    apply: applyType.serve,</span><br><span class="line">    transformIndexHtml(indexHtml: <span class="built_in">string</span>) &#123;</span><br><span class="line">      <span class="comment">// 将 index.html 中的 script 换成 main.tsx，同时不使用 style.css 的样式（因为dev环境下没有生成）</span></span><br><span class="line">      <span class="keyword">return</span> indexHtml</span><br><span class="line">        .replace(<span class="string">`type="text/javascript"`</span>, <span class="string">`type="module"`</span>)</span><br><span class="line">        .replace(<span class="string">`src="<span class="subst">$&#123;dist中js文件名称&#125;</span>.umd.js"`</span>, <span class="string">`src="/src/main.tsx""`</span>)</span><br><span class="line">        .replace(<span class="string">`href="style.css"`</span>, <span class="string">''</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> buildHtmlPlugin = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ...html(&#123;</span><br><span class="line">      template: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!indexHtmlContent?.length) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'没有找到 index.html 文件'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> indexHtmlContent;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">    name: <span class="string">'generate html for production'</span>,</span><br><span class="line">    apply: applyType.build,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>






      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rickiewoo.github.io/2021/04/13/%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E5%AF%B9%E6%AF%94/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/sasuke.jpeg">
      <meta itemprop="name" content="Rickie Woo">
      <meta itemprop="description" content="We were both young when I first saw you.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rickie Woo's Wonder Land">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/13/%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E5%AF%B9%E6%AF%94/" class="post-title-link" itemprop="url">状态管理对比</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-04-13 11:03:26" itemprop="dateCreated datePublished" datetime="2021-04-13T11:03:26+08:00">2021-04-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-04-14 18:34:58" itemprop="dateModified" datetime="2021-04-14T18:34:58+08:00">2021-04-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="状态管理"><a href="#状态管理" class="headerlink" title="状态管理"></a>状态管理</h1><p><a href="https://daveceddia.com/react-state-management/" target="_blank" rel="noopener">https://daveceddia.com/react-state-management/</a></p>
<h2 id="Redux"><a href="#Redux" class="headerlink" title="Redux"></a>Redux</h2><p>通常与React捆绑在一起，但是其核心是<strong>独立的</strong>，因此可以与任何UI库或框架一起使用。</p>
<ul>
<li>缺点：<ul>
<li>陡峭的学习曲线</li>
<li>冗长的 action 到 reducer  的过程（严重依赖不变性）</li>
</ul>
</li>
<li>优点<ul>
<li>最大的社区和生态系统</li>
<li>官方<a href="https://redux-toolkit.js.org/" target="_blank" rel="noopener">Redux Toolkit</a>库减少了样板代码</li>
<li>size</li>
<li>Time travel debugging</li>
<li>拥有自己的库生态系统，可用于执行与本地存储同步，管理API请求等操作</li>
<li>出色的devtools使调试变得简单</li>
</ul>
</li>
</ul>
<h2 id="MobX"><a href="#MobX" class="headerlink" title="MobX"></a>MobX</h2><p><strong>MobX</strong>是一个非常流行的，<strong>包含电池？的</strong>状态管理库，主要（但非专门）用于React。</p>
<p>MobX无疑是 <a href="https://bundlephobia.com/result?p=mobx" target="_blank" rel="noopener">不小的 lib</a>，但是与Redux相比，有些人可能会发现它的API和<strong>可观察的方法</strong>更令人愉悦。这种库仍然有一个明显的学习曲线，但是在那之后，它确实比传统的Redux感觉更好并且<strong>没有重复性</strong>。</p>
<p>MobX的API很好，并且可以生成一些非常漂亮和干净的代码，但是深层来说，它是一个沉重的库，很难完全掌握。最重要的是，它会带来一个明显更小的社区和生态系统。</p>
<hr>
<p>MobX基于观察者/可观察模式。创建一个可观察的数据模型，将组件标记为该数据的“观察者”，MobX将自动跟踪它们访问的数据，并在更改时重新呈现它们。</p>
<p>使用者可以随意定义自己认为合适的数据模型，并提供监视模型变化、并对这些变化做出反应的工具。</p>
<p>MobX的背后是使用ES6代理来检测更改，因此更新可观察数据就像使用普通的旧赋值运算符<code>=</code>一样容易。</p>
<ul>
<li><p>优点</p>
<ul>
<li>以一种真正的“反应式”方式管理状态，以便在您修改值时，使用该值的所有组件都将自动重新呈现</li>
<li>无需进行任何操作或减速器，只需修改您的状态，应用程序便会反映出来。</li>
<li>神奇的反应性意味着更少的代码编写。</li>
<li>您可以编写常规的可变代码。无需特殊的设置器功能或不变性。</li>
</ul>
</li>
<li><p>缺点</p>
<ul>
<li>由于没有Redux广泛使用，因此社区支持（教程等）较少，但是受到用户的喜爱</li>
<li>神奇的反应性意味着不太明确的代码。（根据您对自动更新“魔术”的感觉，这可能是赞成也可能是反对）</li>
<li>对ES6代理的要求意味着不支持IE11及以下版本。（如果您的应用程序要求支持IE，则较旧版本的MobX无需代理即可工作）</li>
</ul>
</li>
</ul>
<h2 id="Recoil"><a href="#Recoil" class="headerlink" title="Recoil"></a>Recoil</h2><p><a href="https://www.recoiljs.cn/docs/introduction/getting-started" target="_blank" rel="noopener">https://www.recoiljs.cn/docs/introduction/getting-started</a></p>
<blockquote>
<p><strong>Recoil</strong>作为<em>“ Facebook实验”</em>，它在今年年初处于<strong>不稳定阶段</strong>“启动”时获得了很大的吸引力。</p>
<p>现代<strong>的基于原子的</strong>状态管理方法和<strong>以钩子为中心的</strong>流畅<strong>API</strong>确实使它颇具吸引力。</p>
<p>但是，由于Recoil的试验阶段，现在建议不要在生产级项目中使用它。</p>
</blockquote>
<p>API就像是React的useState和Context API的组合，因此感觉与React非常相似。</p>
<p>要使用它，您可以将组件树包装为<code>RecoilRoot</code>（类似于使用自己的Context Provider的方式）。然后在顶层创建状态的“atom”，每个原子都有一个唯一的键。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> currentLanguage = atom(&#123;</span><br><span class="line">  key: <span class="string">'currentLanguage'</span>,</span><br><span class="line">  <span class="keyword">default</span>: <span class="string">'en'</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>然后，组件可以使用<code>useRecoilState</code>钩子访问此状态，该钩子的工作方式非常类似于<code>useState</code>：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">LanguageSelector</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [language, setLanguage] = useRecoilState(currentLanguage);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;Languauge is &#123;language&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;button onClick=&#123;() =&gt; setLanguage('es')&#125;&gt;</span></span><br><span class="line"><span class="regexp">      Switch to Español</span></span><br><span class="line"><span class="regexp">    &lt;/</span>button&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>还有一个“selectors”的概念，可让您创建一个原子视图：想到<em>派生</em>状态，例如“将TODO列表过滤为已完成的状态”。</p>
<p>通过跟踪对的调用<code>useRecoilState</code>，Recoil可以跟踪哪些组件使用哪些原子。这样，它可以<em>仅</em>在数据更改时<em>仅</em>重新呈现“订阅”到数据的组件，因此该方法应在性能方面很好地扩展。</p>
<h4 id="好处"><a href="#好处" class="headerlink" title="好处"></a>好处</h4><ul>
<li>与React非常相似的简单API</li>
<li>Facebook在其一些内部工具中使用了它</li>
<li>专为性能而设计</li>
<li>在有或没有React Suspense的情况下均可使用（虽然仍处于试验阶段）</li>
</ul>
<h4 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h4><ul>
<li>只有几个月的历史，因此社区资源和最佳实践还不如其他库强大。</li>
</ul>
<h2 id="Akita？"><a href="#Akita？" class="headerlink" title="Akita？"></a>Akita？</h2><p>基于类的组件比较合适</p>
<p>是面向对象的API</p>
<h2 id="HookStat"><a href="#HookStat" class="headerlink" title="HookStat"></a>HookStat</h2><p>它体积小，最小，干净，可扩展，并且具有一个漂亮<strong>的基于钩子的API</strong>。</p>
<p>它不仅可以用于全局状态，还可以通过附加功能增强本地<code>useState（）</code>，在不影响性能的情况下处理<strong>嵌套状态</strong>，并轻松处理<strong>异步数据</strong>！</p>
<h3 id="useStat什么时候not-enough"><a href="#useStat什么时候not-enough" class="headerlink" title="useStat什么时候not enough"></a>useStat什么时候not enough</h3><p>该<a href="https://daveceddia.com/usestate-hook-examples/" target="_blank" rel="noopener">useState钩</a>非常适合少量llocal组件状态。每个<code>useState</code>调用可以包含一个值，虽然您<em>可以</em>使一个值成为包含许多其他值的对象，但是最好将它们拆分。</p>
<p>一旦您<code>useState</code>在一个组件中遇到3-5次调用，事情就可能变得难以跟踪。<em>尤其是</em>那些状态位彼此依赖时。对于复杂的相互依赖关系，适当的<a href="https://daveceddia.com/react-confirmation-modal-state-machine/" target="_blank" rel="noopener">状态机</a>可能是更好的选择。</p>
<h3 id="next，-useReducer：-中度复杂的React组件状态管理"><a href="#next，-useReducer：-中度复杂的React组件状态管理" class="headerlink" title="next， useReducer： 中度复杂的React组件状态管理"></a>next， useReducer： 中度复杂的React组件状态管理</h3><p>useState的下一步“向上”是<code>useReducer</code>。reducer提供了一个集中的位置，可以拦截“action”并相应地更新状态。像这样的调用<code>useState</code>只能保存一个值，但是更为普遍的是使用<code>useReducer</code>处理一个包含多个值的对象。</p>
<h3 id="useContext-将值传递给子组件而不用层层钻"><a href="#useContext-将值传递给子组件而不用层层钻" class="headerlink" title="useContext : 将值传递给子组件而不用层层钻"></a>useContext : 将值传递给子组件而不用层层钻</h3><p>除了<code>useState</code>和<code>useReducer</code>，另一个痛点是：当您拥有一个拥有某种状态的组件，然后需要向下访问5个子组件的状态时，您必须手动钻取每个级别的子组件。</p>
<p>这里最简单的解决方案是Context API。它内置在React中。</p>
<p>尽管它很简单，但是Context有一个重要的缺点，那就是性能，因此要小心使用。</p>
<p>原因是<code>useContext</code>当提供者的<code>value</code>属性更改时，调用的每个组件都会重新呈现。设想如果该值是一个对象，该对象包含整个应用程序中使用的50个不同的状态位，将会发生什么。而且它们经常且独立地变化。这些值<em>之一</em>每次更改时，使用其中<em>任何</em>一个的每个组件都会重新呈现。</p>
<p><strong>为了避免这种陷阱，请在每个上下文中存储一小部分相关数据，然后将数据拆分到多个上下文中（您可以根据需要拥有尽可能多的数据）。或者，考虑使用第三方库。</strong></p>
<p>另一个要避免的性能陷阱是<code>value</code>，每次都将一个新的对象传递给提供程序的对象。 比如 <code>value = { aProp }</code>,每次渲染都会重新创建包裹<code>aProp</code>的对象。</p>
<h3 id="结合Redux"><a href="#结合Redux" class="headerlink" title="结合Redux"></a>结合Redux</h3><p><strong>您可以同时使用Redux和Context，并且可以<code>useReducer</code>一起使用！</strong> 我们特别鼓励<a href="https://redux.js.org/tutorials/essentials/part-2-app-structure#component-state-and-forms" target="_blank" rel="noopener">在Redux中放置“全局状态”，在React组件中放置“本地状态”</a>，并<a href="https://redux.js.org/style-guide/style-guide#evaluate-where-each-piece-of-state-should-live" target="_blank" rel="noopener">仔细决定每个状态应该处于Redux还是组件状态</a>。因此，您可以<code>useReducer</code>在同一应用程序中同时将Redux用于全局的某些状态，将+ Context用于更局部的状态，将Context本身用于某些半静态值。</p>
<p><a href="https://blog.isquaredsoftware.com/2021/01/context-redux-differences/" target="_blank" rel="noopener">了解Context与Redux的不同之处</a></p>
<h2 id="Dova-。。。"><a href="#Dova-。。。" class="headerlink" title="Dova 。。。"></a>Dova 。。。</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rickiewoo.github.io/2021/03/29/Flux/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/sasuke.jpeg">
      <meta itemprop="name" content="Rickie Woo">
      <meta itemprop="description" content="We were both young when I first saw you.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rickie Woo's Wonder Land">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/29/Flux/" class="post-title-link" itemprop="url">Flux</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-03-29 10:39:57 / Modified: 19:57:53" itemprop="dateCreated datePublished" datetime="2021-03-29T10:39:57+08:00">2021-03-29</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Flux"><a href="#Flux" class="headerlink" title="Flux"></a>Flux</h1><p>##concepts</p>
<p><img src="https://github.com/facebook/flux/raw/master/examples/flux-concepts/flux-simple-f8-diagram-with-client-action-1300w.png" alt="Data flow within Flux application"></p>
<p>Flux是一种管理应用中数据流的模式。最重要的观点是单向数据流。</p>
<p>Flux由Dispatcher、store、view、action构成</p>
<h3 id="Dispatcher"><a href="#Dispatcher" class="headerlink" title="Dispatcher"></a>Dispatcher</h3><p><code>dispatcher</code>接收<code>action</code>并把它们派发给已经在<code>disipatcher</code>中注册过的<code>store</code>。<strong>每一个<code>store</code>都会收到所有<code>action</code></strong>。在每一个应用中应该只有一个单例<code>dispatcher</code>.</p>
<h3 id="Store"><a href="#Store" class="headerlink" title="Store"></a>Store</h3><p><code>store</code>存储了一个应用的数据。<code>store</code>通过注册到应用程序的<code>dispatcher</code>上接受<code>action</code>。一个<code>store</code>中的所有数据都只能因为响应行为发生变化。在一个<code>store</code>中只能有<code>getter</code>，不能有任何<code>public setter</code>，<code>store</code>决定了他们要响应什么<code>action</code>，每次一个<code>store</code>的数据变化必须<code>emit</code>一个<code>change event</code>。在一个应用程序中会有多个<code>store</code></p>
<h3 id="Actions"><a href="#Actions" class="headerlink" title="Actions"></a>Actions</h3><p>Actions 定义了应用程序内部的API，他们捕获应用程序内所有的交互，他们是简单的包含type字段和一些数据的对象</p>
<p>Actions应该是语义化的，描述所发生的action，但是不应该描述该action的实现细节。使用“删除用户”而不是将其分解为“删除用户ID”，“清除用户数据”，“刷新凭证”（或者该过程有效）。请记住，所有存储都将收到该操作，并且可以知道它们需要通过处理相同的“删除用户”操作来清除数据或刷新凭据。</p>
<h3 id="Views"><a href="#Views" class="headerlink" title="Views"></a>Views</h3><p>store中的数据会被称现在view追踪，views可以使用任何框架，例如react。当一个view使用了来自某个store的数据，他必须订阅来自那个store的change事件。然后当store出发一个change事件时，view可以得到新的数据并重新渲染。如果一个组件使用了一个store，但是并没有订阅，很可能会有细微的错误。当用户与应用程序界面的各个部分进行交互时，通常会从视图view中调度action。</p>
<h3 id="数据流"><a href="#数据流" class="headerlink" title="数据流"></a>数据流</h3><ol>
<li>view发送action到dsipatcher</li>
<li>dispatcher发送action到每一个store</li>
<li>store发送数据到view</li>
</ol>
<p>（是store主动发送数据到view，而不是view从store获取数据）</p>
<h2 id="flux-async"><a href="#flux-async" class="headerlink" title="flux-async"></a>flux-async</h2><h3 id="DataManager"><a href="#DataManager" class="headerlink" title="DataManager"></a>DataManager</h3><p>DataManagers是flex中服务器痛心的方法，DataManagers将入参转化为action，作为结果的action应始终被异步调度，这样可以在调度该action的之前留出API请求的时间。</p>
<p>DataManagers只应该被store调用。</p>
<p>TODO</p>
<ul>
<li>flux的缺点    <ul>
<li>多个store有什么优缺点</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rickiewoo.github.io/2021/03/26/Redux/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/sasuke.jpeg">
      <meta itemprop="name" content="Rickie Woo">
      <meta itemprop="description" content="We were both young when I first saw you.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rickie Woo's Wonder Land">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/26/Redux/" class="post-title-link" itemprop="url">Redux</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-03-26 16:22:51" itemprop="dateCreated datePublished" datetime="2021-03-26T16:22:51+08:00">2021-03-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-03-30 14:33:24" itemprop="dateModified" datetime="2021-03-30T14:33:24+08:00">2021-03-30</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Redux"><a href="#Redux" class="headerlink" title="Redux"></a>Redux</h1><p>redux is powerful：redux可以追踪每一个变化背后的行为。</p>
<p><img src="https://miro.medium.com/max/825/1*N62EZSeQNHtwVumCQOdU-Q.png" alt="img"></p>
<h2 id="Redux与Flux"><a href="#Redux与Flux" class="headerlink" title="Redux与Flux"></a>Redux与Flux</h2><p><img src="https://user-gold-cdn.xitu.io/2019/3/24/169ad99f6092e26b?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="123"></p>
<p>Redux受到了Flux架构的启发，但在实现上有一些不同：</p>
<ul>
<li>Redux并没有 dispatcher。它依赖纯函数来替代事件处理器，也不需要额外的实体来管理它们。Flux尝尝被表述为：<code>(state, action) =&gt; state</code>，而纯函数也是实现了这一思想。</li>
<li>Redux为不可变数据集。在每次Action请求触发以后，Redux都会生成一个新的对象来更新State，而不是在当前状态上进行更改。</li>
<li>Redux有且只有一个Store对象。它的Store储存了整个应用程序的State。</li>
</ul>
<h2 id="术语及概念"><a href="#术语及概念" class="headerlink" title="术语及概念"></a>术语及概念</h2><h3 id="不变性"><a href="#不变性" class="headerlink" title="不变性"></a>不变性</h3><p>redux期望所有值的更新都是不变的，也就是说对于引用类型，我们需要复制deep原变量并在此基础上做更改。</p>
<h3 id="redux中的数据流"><a href="#redux中的数据流" class="headerlink" title="redux中的数据流"></a>redux中的数据流</h3><ul>
<li>init<ul>
<li>使用root reducer函数创建一个store</li>
<li>store调用一次reducer，并保存它的返回值作为自己的初始state</li>
<li>当UI初次渲染时，UI组件会访问store中当前的state，并使用里面的数据决定渲染什么。他们也会订阅store中任何未来的的更改来知道state是否发生了变化。</li>
</ul>
</li>
<li>updates<ul>
<li>一些事件发生，比如用户点击一个按钮</li>
<li>app代码派发一个行为到store，比如<code>dispatch({type: &#39;counter/increment&#39;})</code></li>
<li>store再次运行reducer的function，使用上一个state和当前action，并保存返回值作为新的state</li>
<li>store通知所有订阅store的UI：store已经更新了</li>
<li>每一个从store中获取数据的UI组件检查他们需要的这部分数据是否发生变化</li>
<li>每个看到其数据已更改的组件都会强制使用新数据重新渲染，因此它可以更新屏幕上显示的内容</li>
</ul>
</li>
</ul>
<p><img src="https://redux.js.org/assets/images/ReduxDataFlowDiagram-49fa8c3968371d9ef6f2a1486bd40a26.gif" alt="Redux data flow diagram"></p>
<h3 id="actions"><a href="#actions" class="headerlink" title="actions"></a>actions</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. plain object</span></span><br><span class="line"><span class="comment">// 2. has a type</span></span><br><span class="line"><span class="comment">// 3. whatever else you want</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">type</span>: <span class="string">"USER_LOGGED_IN"</span>,</span><br><span class="line">  username: <span class="string">"dave"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>action是具有type属性的普通对象</p>
<h3 id="action-creators"><a href="#action-creators" class="headerlink" title="action creators"></a>action creators</h3><p>而且，由于总是手动编写这些对象会很烦人（更不用说容易出错），因此Redux具有“action creators”的概念，可以将这些内容淘汰掉</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">userLoggedIn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="keyword">type</span>: <span class="string">'USER_LOGGED_IN'</span>,</span><br><span class="line">    username: <span class="string">'dave'</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Redux-toolKit"><a href="#Redux-toolKit" class="headerlink" title="Redux toolKit"></a>Redux toolKit</h2><p>Immer library？</p>
<p>将变更检测存为草稿状态（draft state）并基于这些变更产生一个全新的不可变状态</p>
<p>⬆️在RTK中，reduder中的state是草稿state</p>
<h3 id="Thunk"><a href="#Thunk" class="headerlink" title="Thunk"></a>Thunk</h3><blockquote>
<p><a href="https://daveceddia.com/what-is-a-thunk/" target="_blank" rel="noopener">https://daveceddia.com/what-is-a-thunk/</a></p>
</blockquote>
<p>thunk是function的另一种说法，不过thunk特指返回一个function的function。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">wrapper_function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// this one is a "thunk" because it defers work for later:</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">thunk</span>(<span class="params"></span>) </span>&#123;   <span class="comment">// it can be named, or anonymous</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'do stuff now'</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rickiewoo.github.io/2021/03/22/%E7%8F%AD%E7%BA%A7%E5%88%97%E8%A1%A8%E6%94%AF%E6%8C%81%E5%A4%9A%E7%A7%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/sasuke.jpeg">
      <meta itemprop="name" content="Rickie Woo">
      <meta itemprop="description" content="We were both young when I first saw you.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rickie Woo's Wonder Land">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/22/%E7%8F%AD%E7%BA%A7%E5%88%97%E8%A1%A8%E6%94%AF%E6%8C%81%E5%A4%9A%E7%A7%91/" class="post-title-link" itemprop="url">班级列表支持多科</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-03-22 23:16:19" itemprop="dateCreated datePublished" datetime="2021-03-22T23:16:19+08:00">2021-03-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-03-23 10:33:03" itemprop="dateModified" datetime="2021-03-23T10:33:03+08:00">2021-03-23</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>#班级列表支持多科</p>
<h2 id="table实现现状"><a href="#table实现现状" class="headerlink" title="table实现现状"></a>table实现现状</h2><ul>
<li><p>每个列表有自己的表头</p>
<ul>
<li>表头使用<code>nz-table</code>自带<code>api</code>即可实现，想要复用只要使用相同的(<code>columns</code>)配置即可</li>
</ul>
</li>
<li><p>列表项使用<code>app-list-item</code>作为属性选择器</p>
<ul>
<li><p>如果直接写为元素<code>&lt;app-list-item&gt;</code>，需要考虑在<code>table</code>场景下该标签的识别问题，通常会导致table样式混乱</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">app-list-item</span>&gt;</span> <span class="comment">&lt;!--导致样式混乱--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">app-list-item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<p>![image-20210322233835963](/Users/rickie/Library/Application Support/typora-user-images/image-20210322233835963.png)</p>
<p>##需求</p>
<p>表头</p>
<p>![image-20210323022910742](/Users/rickie/Library/Application Support/typora-user-images/image-20210323022910742.png)</p>
<ul>
<li><p>表头</p>
<ul>
<li>沟通池和班级学生列表的表头及其筛选项基本一致</li>
<li>部分筛选需要定制为多科展示<ul>
<li><code>nz-table</code>中内置的筛选器已无法满足，需要自定义筛选器</li>
</ul>
</li>
<li>⬆️要求我们抽出一个<code>table-header</code>组件，已便复用</li>
</ul>
</li>
<li><p>进一步思考：</p>
<ul>
<li>沿<code>nz-table</code>的思想，将<code>table-header</code>组件设置为根据column配置渲染，在原有的<code>column</code>基础上，支持配置每一个key自定义筛选</li>
<li>某些筛选与普通的表单类似，支持使用<code>form-creator</code>创建自定义筛选器的内容</li>
<li>将自定义模板及其方法写在相关的<code>&lt;table&gt;</code>下，不污染<code>table-header</code>组件<ul>
<li>![image-20210323001641922](/Users/rickie/Library/Application Support/typora-user-images/image-20210323001641922.png)</li>
</ul>
</li>
<li>筛选项中有一部分是在原来的单、多选基础上根据学科分组<ul>
<li><img src="file:///Users/rickie/Library/Application%20Support/typora-user-images/image-20210323001513786.png?lastModify=1616429709" alt="image-20210323001513786"></li>
<li>可以将这部分功能抽成一个可复用组件</li>
</ul>
</li>
</ul>
</li>
<li><p>列表项</p>
<ul>
<li>列表项中部分数据需要展示多科，对齐展示</li>
<li>![image-20210322232031555](/Users/rickie/Library/Application Support/typora-user-images/image-20210322232031555.png)</li>
</ul>
</li>
</ul>
<p>![image-20210323003507733](/Users/rickie/Library/Application Support/typora-user-images/image-20210323003507733.png)</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rickiewoo.github.io/2021/03/19/TemplateRef/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/sasuke.jpeg">
      <meta itemprop="name" content="Rickie Woo">
      <meta itemprop="description" content="We were both young when I first saw you.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rickie Woo's Wonder Land">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/19/TemplateRef/" class="post-title-link" itemprop="url">TemplateRef</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-03-19 15:14:39" itemprop="dateCreated datePublished" datetime="2021-03-19T15:14:39+08:00">2021-03-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-03-23 13:55:01" itemprop="dateModified" datetime="2021-03-23T13:55:01+08:00">2021-03-23</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="TemplateRef"><a href="#TemplateRef" class="headerlink" title="TemplateRef"></a>TemplateRef</h3><blockquote>
<p><a href="https://angular.cn/api/core/TemplateRef" target="_blank" rel="noopener">https://angular.cn/api/core/TemplateRef</a></p>
</blockquote>
<p>定义：表示一个内嵌模板，它可用于实例化内嵌的视图。</p>
<p>说明：通过把一个指令放在ng-template上，或一个带*前缀的指令，可以访问TemplatRef实例。</p>
<p>内嵌视图的TemplateRef实例会以TemplateRef作为token，注入到该指令的构造函数中。</p>
<p>属性：abstract elementRef: ElementRef</p>
<ul>
<li>当前内嵌视图在父视图的锚点元素</li>
<li>对于从这个 <code>TemplateRef</code> 创建的内嵌视图，其数据绑定和依赖注入的上下文是从<strong>当前位置</strong>的上下文中继承而来的。</li>
<li>通常，新的内嵌视图会被附加到当前位置的视图容器中，<strong>但是在一些高级用例中，该视图可能被附加到别的容器中， 同时还保留原位置的数据绑定和依赖注入上下文</strong>。</li>
</ul>
<p>方法：</p>
<ul>
<li><p>createEmbeddedView()</p>
<ul>
<li>创建一个视图对象，并把它附着到父视图的视图容器上。</li>
<li>![WeChatWorkScreenshot_c87a6501-8bb3-4f25-a95c-d75d5876a763](/Users/rickie/Library/Containers/com.tencent.WeWorkMac/Data/Library/Application Support/WXWork/Temp/ScreenCapture/WeChatWorkScreenshot_c87a6501-8bb3-4f25-a95c-d75d5876a763.png)</li>
<li>![image-20210322153553829](/Users/rickie/Library/Application Support/typora-user-images/image-20210322153553829.png)</li>
</ul>
<p>以下模板分别为两个单独的TemplateRef实例，一个外部实例和一个内部实例</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Count: &#123;&#123;items.length&#125;&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> *<span class="attr">ngFor</span>=<span class="string">"let  item of items"</span>&gt;</span>&#123;&#123;item&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--外部 TemplatRef--&gt;</span></span><br><span class="line">Count: &#123;&#123;items.length&#125;&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ng-template</span> <span class="attr">ngFor</span> <span class="attr">let-item</span> [<span class="attr">ngForOf</span>]=<span class="string">"items"</span>&gt;</span><span class="tag">&lt;/<span class="name">ng-template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--内部 TemplatRef--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123;item&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 外部和内部 TemplateRef 实例按如下方式组装到视图中 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ViewRef: outer-0 --&gt;</span></span><br><span class="line">Count: 2</span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ng-template</span> <span class="attr">view-container-ref</span>&gt;</span><span class="tag">&lt;/<span class="name">ng-template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- ViewRef: inner-1 --&gt;</span><span class="tag">&lt;<span class="name">li</span>&gt;</span>first<span class="tag">&lt;/<span class="name">li</span>&gt;</span><span class="comment">&lt;!-- /ViewRef: inner-1 --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- ViewRef: inner-2 --&gt;</span><span class="tag">&lt;<span class="name">li</span>&gt;</span>second<span class="tag">&lt;/<span class="name">li</span>&gt;</span><span class="comment">&lt;!-- /ViewRef: inner-2 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- /ViewRef: outer-0 --&gt;</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<h4 id="template"><a href="#template" class="headerlink" title="template"></a>template</h4><p><img src="https://segmentfault.com/img/bVKyfR?w=680&h=389/view" alt="preview"></p>
<p>从上图中，我们发现 <template> 模板元素，渲染后被替换成 comment 元素，那么如何展示的呢？</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;Component, TemplateRef, ViewChild, AfterViewInit&#125; <span class="keyword">from</span> <span class="string">'@angular/core'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">  selector: <span class="string">'my-app'</span>,</span><br><span class="line">  template: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;h1&gt;Welcome to Angular World&lt;/h1&gt;</span></span><br><span class="line"><span class="string">    &lt;template #tpl&gt;</span></span><br><span class="line"><span class="string">      &lt;span&gt;I am span in template&lt;/span&gt;</span></span><br><span class="line"><span class="string">    &lt;/template&gt;</span></span><br><span class="line"><span class="string">  `</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppComponent &#123;</span><br><span class="line">  name: <span class="built_in">string</span> = <span class="string">'Semlinker'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@ViewChild</span>(<span class="string">'tpl'</span>)</span><br><span class="line">  tpl: TemplateRef&lt;<span class="built_in">any</span>&gt;;</span><br><span class="line"></span><br><span class="line">  ngAfterViewInit() &#123;</span><br><span class="line">    <span class="keyword">let</span> embeddedView = <span class="keyword">this</span>.tpl.createEmbeddedView(<span class="literal">null</span>);</span><br><span class="line">    <span class="built_in">console</span>.dir(embeddedView);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://segmentfault.com/img/bVKyfW?w=469&h=201" alt="图片描述"></p>
<p>从图中我们可以知道，当调用 createEmbeddedView 方法后返回了 ViewRef_ 视图对象。该视图对象的 rootNodes 属性包含了 <template> 模板中的内容。在上面的例子中，我们知道了 TemplateRef 实例对象中的 elementRef 属性封装了我们的 comment 元素，那么我们可以通过 insertBefore 方法来创建我们模板中定义的内容。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Component, TemplateRef, ViewChild, AfterViewInit &#125; from &#39;@angular&#x2F;core&#39;;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">  selector: &#39;my-app&#39;,</span><br><span class="line">  template: &#96;</span><br><span class="line">    &lt;h1&gt;Welcome to Angular World&lt;&#x2F;h1&gt;</span><br><span class="line">    &lt;template #tpl&gt;</span><br><span class="line">      &lt;span&gt;I am span in template &#123;&#123;name&#125;&#125;&lt;&#x2F;span&gt;</span><br><span class="line">    &lt;&#x2F;template&gt;</span><br><span class="line">  &#96;,</span><br><span class="line">&#125;)</span><br><span class="line">export class AppComponent &#123;</span><br><span class="line">  name: string &#x3D; &#39;Semlinker&#39;;</span><br><span class="line"></span><br><span class="line">  @ViewChild(&#39;tpl&#39;)</span><br><span class="line">  tpl: TemplateRef&lt;any&gt;;</span><br><span class="line"></span><br><span class="line">  ngAfterViewInit() &#123;</span><br><span class="line">    &#x2F;&#x2F; 页面中的&lt;!--template bindings&#x3D;&#123;&#125;--&gt;元素</span><br><span class="line">    let commentElement &#x3D; this.tpl.elementRef.nativeElement;</span><br><span class="line">    &#x2F;&#x2F; 创建内嵌视图</span><br><span class="line">    let embeddedView &#x3D; this.tpl.createEmbeddedView(null);</span><br><span class="line">    &#x2F;&#x2F; 动态添加子节点</span><br><span class="line">    embeddedView.rootNodes.forEach((node) &#x3D;&gt; &#123;</span><br><span class="line">        commentElement.parentNode</span><br><span class="line">          .insertBefore(node, commentElement.nextSibling);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>创建内嵌视图(embedded view)</li>
<li>遍历内嵌视图中的 rootNodes，动态的插入 node</li>
</ul>
<h3 id="ViewContainerRef"><a href="#ViewContainerRef" class="headerlink" title="ViewContainerRef"></a>ViewContainerRef</h3><blockquote>
<p><a href="https://angular.cn/api/core/ViewContainerRef" target="_blank" rel="noopener">https://angular.cn/api/core/ViewContainerRef</a></p>
</blockquote>
<p>表示可以将一个或多个视图附着到组件中的容器。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @angular/core/src/linker/view_container_ref.d.ts</span></span><br><span class="line"><span class="comment">// 用于表示一个视图容器，可添加一个或多个视图</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">declare</span> <span class="keyword">class</span> ViewContainerRef_ <span class="keyword">implements</span> ViewContainerRef &#123;</span><br><span class="line">    ...</span><br><span class="line">    length: <span class="built_in">number</span>; <span class="comment">// 返回视图容器中已存在的视图个数</span></span><br><span class="line">    element: ElementRef;</span><br><span class="line">    injector: Injector;</span><br><span class="line">    parentInjector: Injector;</span><br><span class="line">      <span class="comment">// 基于TemplateRef创建内嵌视图，并自动添加到视图容器中，可通过index设置</span></span><br><span class="line">    <span class="comment">// 视图添加的位置</span></span><br><span class="line">    createEmbeddedView&lt;C&gt;(templateRef: TemplateRef&lt;C&gt;, context?: C, </span><br><span class="line">      index?: <span class="built_in">number</span>): EmbeddedViewRef&lt;C&gt;;</span><br><span class="line">    <span class="comment">// 基 ComponentFactory创建组件视图</span></span><br><span class="line">    createComponent&lt;C&gt;(componentFactory: ComponentFactory&lt;C&gt;,</span><br><span class="line">      index?: <span class="built_in">number</span>, injector?: Injector, projectableNodes?: <span class="built_in">any</span>[][]): ComponentRef&lt;C&gt;;</span><br><span class="line">    insert(viewRef: ViewRef, index?: <span class="built_in">number</span>): ViewRef;</span><br><span class="line">    move(viewRef: ViewRef, currentIndex: <span class="built_in">number</span>): ViewRef;</span><br><span class="line">    indexOf(viewRef: ViewRef): <span class="built_in">number</span>;</span><br><span class="line">    remove(index?: <span class="built_in">number</span>): <span class="built_in">void</span>;</span><br><span class="line">    detach(index?: <span class="built_in">number</span>): ViewRef;</span><br><span class="line">    clear(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TemplateRef：用于表示内嵌的 template 模板元素，通过 TemplateRef 实例，我们可以方便创建内嵌视图(Embedded Views)，且可以轻松地访问到通过 ElementRef 封装后的 nativeElement。需要注意的是组件视图中的 template 模板元素，经过渲染后会被替换成 comment 元素。</p>
<p>ViewContainerRef：用于表示一个视图容器，可添加一个或多个视图。通过 ViewContainer<br>Ref 实例，我们可以基于 TemplateRef 实例创建内嵌视图，并能指定内嵌视图的插入位置，也可以方便对视图容器中已有的视图进行管理。简而言之，ViewContainerRef 的主要作用是创建和管理内嵌视图或组件视图。</p>
<h3 id="View"><a href="#View" class="headerlink" title="View"></a>View</h3><blockquote>
<p><a href="https://angular.cn/guide/glossary#view" target="_blank" rel="noopener">https://angular.cn/guide/glossary#view</a></p>
</blockquote>
<p>视图是可显示元素的最小分组单位，它们会被同时创建和销毁。 Angular 在一个或多个<a href="https://angular.cn/guide/glossary#directive" target="_blank" rel="noopener">指令 (directive)</a> 的控制下渲染视图。</p>
<p>具体实现上，视图由一个与该组件相关的 <code>ViewRef</code> 实例表示。 直属于某个组件的视图叫做<em>宿主视图</em>。 通常会把视图组织成一些<a href="https://angular.cn/guide/glossary#view-tree" target="_blank" rel="noopener">视图树（view hierarchies）</a>。</p>
<h3 id="EmbeddedViewRef"><a href="#EmbeddedViewRef" class="headerlink" title="EmbeddedViewRef"></a>EmbeddedViewRef</h3><blockquote>
<p><a href="https://angular.cn/api/core/EmbeddedViewRef" target="_blank" rel="noopener">https://angular.cn/api/core/EmbeddedViewRef</a></p>
</blockquote>
<p>表示视图容器中的 Angular <a href="https://angular.cn/guide/glossary#view" target="_blank" rel="noopener">视图</a>。<a href="https://angular.cn/guide/glossary#view-tree" target="_blank" rel="noopener">嵌入视图</a>可以从在模板中定义它的宿主组件之外的组件中引用，也可以由 <code>TemplateRef</code> 进行独立定义。</p>
<h3 id="ContentChild"><a href="#ContentChild" class="headerlink" title="ContentChild"></a>ContentChild</h3><p>用于配置内容查询的参数修饰器。</p>
<h4 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h4><p>用于从内容 DOM 获取与此选择器匹配的第一个元素或指令。如果内容 DOM 发生了更改，并且有一个新的子项与选择器匹配，则该属性将被更新。</p>
<p>在调用 <code>ngAfterContentInit</code> 之前设置的内容查询。</p>
<p>不检索其他组件模板中的元素或指令，因为组件模板对其祖先来说始终是黑匣子。</p>
<p><strong>元数据属性</strong>：</p>
<ul>
<li><strong>selector</strong> - 要查询的指令类型或名称。</li>
<li><strong>read</strong> - 用于从查询到的元素读取不同的令牌。</li>
<li><strong>static</strong> - 如果为 true，则在变更检测运行之前解析查询结果，如果为 false，则在变更检测之后解析。默认为 false。</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;Component, ContentChild, Directive, Input&#125; <span class="keyword">from</span> <span class="string">'@angular/core'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Directive</span>(&#123;selector: <span class="string">'pane'</span>&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> Pane &#123;</span><br><span class="line">  <span class="meta">@Input</span>() id!: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">  selector: <span class="string">'tab'</span>,</span><br><span class="line">  template: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div&gt;pane: &#123;&#123;pane?.id&#125;&#125;&lt;/div&gt;</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> Tab &#123;</span><br><span class="line">  <span class="meta">@ContentChild</span>(Pane) pane!: Pane;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">  selector: <span class="string">'example-app'</span>,</span><br><span class="line">  template: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;tab&gt;</span></span><br><span class="line"><span class="string">      &lt;pane id="1" *ngIf="shouldShow"&gt;&lt;/pane&gt;</span></span><br><span class="line"><span class="string">      &lt;pane id="2" *ngIf="!shouldShow"&gt;&lt;/pane&gt;</span></span><br><span class="line"><span class="string">    &lt;/tab&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &lt;button (click)="toggle()"&gt;Toggle&lt;/button&gt;</span></span><br><span class="line"><span class="string">  `</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> ContentChildComp &#123;</span><br><span class="line">  shouldShow = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  toggle() &#123;</span><br><span class="line">    <span class="keyword">this</span>.shouldShow = !<span class="keyword">this</span>.shouldShow;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ElementRef"><a href="#ElementRef" class="headerlink" title="ElementRef"></a>ElementRef</h3><blockquote>
<p><a href="https://angular.cn/api/core/ElementRef" target="_blank" rel="noopener">https://angular.cn/api/core/ElementRef</a></p>
</blockquote>
<p>对视图中某个原生元素的包装器。它的背后是一个可渲染的具体元素，例如浏览器中通常为DOM元素。</p>
<p>![image-20210322170031878](/Users/rickie/Library/Application Support/typora-user-images/image-20210322170031878.png)</p>
<h3 id=""><a href="#" class="headerlink" title=""></a></h3><h3 id="deepclone"><a href="#deepclone" class="headerlink" title="deepclone"></a>deepclone</h3><p>lodash的深拷贝方法是相对完善和严谨的，对于特殊的数据类型，环，兼容性等等都考虑到了。但是对于function类型，依然是引用。并且，也没有深拷贝在原型链上的属性。实现的方式主要是以Object.prototype.toString.call得到tag，再分类处理，环由stack解决，symbol由Object.getOwnPropertySymbols方法解决。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rickiewoo.github.io/2021/03/15/React%20hook/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/sasuke.jpeg">
      <meta itemprop="name" content="Rickie Woo">
      <meta itemprop="description" content="We were both young when I first saw you.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rickie Woo's Wonder Land">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/15/React%20hook/" class="post-title-link" itemprop="url">React hook</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-03-15 17:46:03" itemprop="dateCreated datePublished" datetime="2021-03-15T17:46:03+08:00">2021-03-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-03-16 14:35:32" itemprop="dateModified" datetime="2021-03-16T14:35:32+08:00">2021-03-16</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="React-hook"><a href="#React-hook" class="headerlink" title="React hook"></a>React hook</h1><p>##Hook的优点</p>
<p>随时可用:<strong>Hook 使你在无需修改组件结构的情况下复用状态逻辑</strong></p>
<p><strong>Hook 将组件中相互关联的部分拆分成更小的函数（比如设置订阅或请求数据）</strong></p>
<p>向后兼容 且 没有Breaking-change</p>
<p>拥抱函数，在非class的情况下使用更多react特性</p>
<p>##什么是Hook</p>
<p>Hook 是一些可以让你在函数组件里“钩入” React state 及生命周期等特性的函数。Hook *<em>不能在 class 组件中使用 *</em>—— 这使得你不使用 class 也能使用 React。其实就是js函数</p>
<h2 id="Hook-使用规则"><a href="#Hook-使用规则" class="headerlink" title="Hook 使用规则"></a>Hook 使用规则</h2><ul>
<li>只能在<strong>函数最外层</strong>调用 Hook。不要在循环、条件判断或者子函数中调用。</li>
<li>只能在 <strong>React 的函数组件或自定义的 Hook 中</strong>中调用 Hook。</li>
<li>Hook 是一种复用<em>状态逻辑</em>的方式，它不复用 state 本身。事实上 Hook 的每次<em>调用</em>都有一个完全独立的 state —— 因此你可以在单个组件中多次调用同一个自定义 Hook。</li>
</ul>
<p>常用hook</p>
<ul>
<li>useState</li>
<li>useEffect<ul>
<li>跟 class 组件中的 <code>componentDidMount</code>、<code>componentDidUpdate</code> 和 <code>componentWillUnmount</code> 具有相同的用途</li>
<li>默认情况下，React 会在每次渲染后调用副作用函数 —— <strong>包括</strong>第一次渲染的时候</li>
<li>参数<ul>
<li>一个副作用的funtion<ul>
<li>返回值：返回一个函数指定如何清除副作用</li>
</ul>
</li>
<li>一个数组：如果这个数组中所有元素与上一次相等，则会跳过这次effect，性能优化点 </li>
</ul>
</li>
<li></li>
</ul>
</li>
<li>useContext<ul>
<li>接受一个context对象，并返回他的value</li>
</ul>
</li>
<li>useReducer<ul>
<li><a href="https://zh-hans.reactjs.org/docs/hooks-reference.html#usestate" target="_blank" rel="noopener"><code>useState</code></a> 的替代方案</li>
</ul>
</li>
<li>useCallback</li>
<li>useMemo</li>
<li>userRef</li>
</ul>
<p>#React Context</p>
<h2 id="用途"><a href="#用途" class="headerlink" title="用途"></a>用途</h2><p><em>很多</em>不同层级的组件需要访问同样一些的数据</p>
<p>共享那些对于一个组件树而言是“全局”的数据，例如当前认证的用户、主题或首选语言</p>
<h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><h3 id="createContext"><a href="#createContext" class="headerlink" title="createContext"></a><code>createContext</code></h3><p>找离自身最近的provider并读取当前的值</p>
<p>参数defaultValue，注意defaultValue的生效时机</p>
<ul>
<li><p>没有匹配到provider时才生效</p>
</li>
<li><p>设置为undefined时不生效</p>
</li>
</ul>
<h3 id="Class-contextType"><a href="#Class-contextType" class="headerlink" title="Class.contextType"></a><code>Class.contextType</code></h3><p>会被重新赋值为Context对象，然后用this.context的时候会消费最近<code>context</code>上?的值 // TODO</p>
<h3 id="Context-Consumer"><a href="#Context-Consumer" class="headerlink" title="Context.Consumer"></a><code>Context.Consumer</code></h3><p>在<a href="https://zh-hans.reactjs.org/docs/components-and-props.html#function-and-class-components" target="_blank" rel="noopener">函数式组件</a>中可以订阅 context，检测变更</p>
<h3 id="Context-displayName"><a href="#Context-displayName" class="headerlink" title="Context.displayName"></a><code>Context.displayName</code></h3>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rickiewoo.github.io/2021/02/20/%E5%BC%82%E6%AD%A5%E6%B5%81%20async%20%E6%97%B6%EF%BC%8C%E5%BE%97%E5%88%B0%20null%20%E7%9A%84bug/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/sasuke.jpeg">
      <meta itemprop="name" content="Rickie Woo">
      <meta itemprop="description" content="We were both young when I first saw you.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rickie Woo's Wonder Land">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/20/%E5%BC%82%E6%AD%A5%E6%B5%81%20async%20%E6%97%B6%EF%BC%8C%E5%BE%97%E5%88%B0%20null%20%E7%9A%84bug/" class="post-title-link" itemprop="url">异步流 async 时，得到 null 的bug</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-02-20 11:45:13 / Modified: 11:46:16" itemprop="dateCreated datePublished" datetime="2021-02-20T11:45:13+08:00">2021-02-20</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="问题："><a href="#问题：" class="headerlink" title="问题："></a>问题：</h2><p>假设模版代码中使用了asyncPipe：</p>
<p>  obs$ | async</p>
<p>如果obs$是一个异步得到的值，例如请求、delay等<br>那么obs$ | async得到的值为 null，等请求返回、或者到达指定时间时才会返回订阅结果</p>
<h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- *.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">app-component</span> [<span class="attr">input</span>]=<span class="string">"asyncObservable$ | async"</span>&gt;</span><span class="tag">&lt;/<span class="name">app-component</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// *.ts</span></span><br><span class="line"><span class="meta">@Input</span>() <span class="keyword">set</span> input(input: <span class="built_in">any</span>) &#123;</span><br><span class="line">  <span class="comment">// 如果不加判断，则在得到正确的值前，会先有 this.input$.next(null)</span></span><br><span class="line">  <span class="keyword">if</span> (input !== <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.input$.next(input)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">input$ = <span class="keyword">new</span> ReplaySubject&lt;<span class="built_in">any</span>&gt;(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<h2 id="关于asyncPipe"><a href="#关于asyncPipe" class="headerlink" title="关于asyncPipe"></a>关于asyncPipe</h2><p>asyncPipe源码解析：<a href="https://www.cnblogs.com/qianxiaox/p/13750539.html" target="_blank" rel="noopener">https://www.cnblogs.com/qianxiaox/p/13750539.html</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rickiewoo.github.io/2021/02/20/Angular-%E5%8E%BB%E9%99%A4%E7%BB%84%E4%BB%B6%E6%A0%87%E7%AD%BE%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/sasuke.jpeg">
      <meta itemprop="name" content="Rickie Woo">
      <meta itemprop="description" content="We were both young when I first saw you.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rickie Woo's Wonder Land">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/20/Angular-%E5%8E%BB%E9%99%A4%E7%BB%84%E4%BB%B6%E6%A0%87%E7%AD%BE%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" class="post-title-link" itemprop="url">Angular-去除组件标签的解决方案</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-02-20 11:44:35" itemprop="dateCreated datePublished" datetime="2021-02-20T11:44:35+08:00">2021-02-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-03-17 19:13:29" itemprop="dateModified" datetime="2021-03-17T19:13:29+08:00">2021-03-17</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>做老师带多科需求的时候，需要更改各个列表的table header的filter，改动基本一致。</p>
<p>之前每个table的<th>都是写在各自组件的，因为写在组件中，最外层会有个<app-xxx>的标签，会打乱<tr>中的样式。而现在我们不得不将一部分<th>组件抽出来。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>参见 conan-cat-web 中的 <table-header> 组件</p>
<p>createEmbeddedView + style=”display: none”</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// table-header.ts</span></span><br><span class="line"><span class="meta">@ViewChild</span>(<span class="string">'tableHeader'</span>, &#123; <span class="keyword">static</span>: <span class="literal">true</span> &#125;) tableHeaderTpl!: TemplateRef&lt;unknown&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">    <span class="keyword">private</span> viewContainerRef: ViewContainerRef,</span></span><br><span class="line"><span class="params">  </span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">ngOnInit() &#123;</span><br><span class="line">  <span class="keyword">this</span>.viewContainerRef.createEmbeddedView(<span class="keyword">this</span>.tableHeaderTpl);</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- table-header.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ng-template</span> #<span class="attr">tableHeader</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">th</span> *<span class="attr">ngFor</span>=<span class="string">"let item of data"</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ng-template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* style.css */</span></span><br><span class="line"><span class="comment">/* 删除 app-table-header 标签 */</span></span><br><span class="line"><span class="selector-tag">app-table-header</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>: non</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rickiewoo.github.io/2020/12/12/webpack%205%20%E7%AE%80%E4%BB%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/sasuke.jpeg">
      <meta itemprop="name" content="Rickie Woo">
      <meta itemprop="description" content="We were both young when I first saw you.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rickie Woo's Wonder Land">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/12/webpack%205%20%E7%AE%80%E4%BB%8B/" class="post-title-link" itemprop="url">webpack 5 简介</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-12-12 11:21:31" itemprop="dateCreated datePublished" datetime="2020-12-12T11:21:31+08:00">2020-12-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-12-15 13:32:36" itemprop="dateModified" datetime="2020-12-15T13:32:36+08:00">2020-12-15</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="webpack-5-简介"><a href="#webpack-5-简介" class="headerlink" title="webpack 5 简介"></a>webpack 5 简介</h1><p>关于webpack v5.0.0</p>
<h2 id="主要改变"><a href="#主要改变" class="headerlink" title="主要改变"></a>主要改变</h2><ul>
<li>通过持久缓存(Persistent Caching)提高构建性能</li>
<li>用更好的算法和默认值来改进长期缓存(Long Term Caching)</li>
<li>通过更好的 Tree Shaking 和 Code Generation 改善 bundle size</li>
<li>改善与 Web 平台的兼容性</li>
<li>在不引入 breaking change 的情况下，清理那些在实现 v4 时处于奇怪状态的内部结构</li>
<li>通过引入 breaking change 为未来的功能做准备，并允许我们尽量长时间保持在v5</li>
</ul>
<h3 id="关于持久缓存（Persistent-Caching）"><a href="#关于持久缓存（Persistent-Caching）" class="headerlink" title="关于持久缓存（Persistent Caching）"></a>关于持久缓存（Persistent Caching）</h3><h4 id="什么是持久缓存？"><a href="#什么是持久缓存？" class="headerlink" title="什么是持久缓存？"></a>什么是持久缓存？</h4><blockquote>
<p><a href="https://jackrabbit.apache.org/oak/docs/nodestore/persistent-cache.html" target="_blank" rel="noopener">https://jackrabbit.apache.org/oak/docs/nodestore/persistent-cache.html</a></p>
</blockquote>
<p>文件的持久性缓存旨在用于文档和对象的中期存储。</p>
<p>文缓存可以选择性的使用持久缓存。在早期版本中，这种缓存类似于内存中缓存，但是除了将最近使用的节点保留在内存中之外，它还将它们存储到磁盘中。这样，很多读取行为将从存储后端（例如MongoDB）读取替换为本地磁盘读取。如果从本地磁盘读取的速度比从存储后端读取的速度快，这将特别有用。除此之外，持久缓存还可以减轻存储后端的负载。</p>
<h4 id="Webpack-怎么做持久缓存？"><a href="#Webpack-怎么做持久缓存？" class="headerlink" title="Webpack 怎么做持久缓存？"></a>Webpack 怎么做持久缓存？</h4><blockquote>
<p><a href="https://webpack.js.org/blog/2020-10-10-webpack-5-release/#persistent-caching" target="_blank" rel="noopener">https://webpack.js.org/blog/2020-10-10-webpack-5-release/#persistent-caching</a></p>
<p><a href="https://github.com/webpack/changelog-v5/blob/master/guides/persistent-caching.md" target="_blank" rel="noopener">https://github.com/webpack/changelog-v5/blob/master/guides/persistent-caching.md</a></p>
</blockquote>
<p>#####一个可选的文件系统缓存</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  cache: &#123;</span><br><span class="line">    <span class="comment">// 1. 将缓存类型设置为文件系统</span></span><br><span class="line">    type: <span class="string">'filesystem'</span>,</span><br><span class="line"></span><br><span class="line">    buildDependencies: &#123;</span><br><span class="line">      <span class="comment">// 2. 将你的 config 添加为 buildDependency，以便在改变 config 时使缓存无效</span></span><br><span class="line">      <span class="comment">// 当配置或配置依赖于require()更改的任何内容时，这会使持久性缓存无效。</span></span><br><span class="line">      config: [__filename],</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 3. 如果你有其他的东西被构建依赖，你可以在这里添加它们</span></span><br><span class="line">      <span class="comment">// 注意，webpack、lodaers 和所有从你的配置中引用的模块都会被自动添加</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h5 id="缓存在哪？"><a href="#缓存在哪？" class="headerlink" title="缓存在哪？"></a>缓存在哪？</h5><p>缓存将默认存储在 <code>node_modules/.cache/webpack</code>（当使用 node_modules 时）或 <code>.yarn/.cache/webpack</code>（当使用 Yarn PnP 时）中。当所有的插件都正确处理缓存时，你可能永远都不需要手动删除它。</p>
<h5 id="谁会使用？"><a href="#谁会使用？" class="headerlink" title="谁会使用？"></a>谁会使用？</h5><p>许多内部插件也会使用持久性缓存。例如 <code>SourceMapDevToolPlugin</code> (缓存 SourceMap 的生成)或 <code>ProgressPlugin</code> (缓存模块数量)</p>
<p>#####什么策略？</p>
<blockquote>
<p><a href="https://webpack.js.org/configuration/other-options/#cache" target="_blank" rel="noopener">https://webpack.js.org/configuration/other-options/#cache</a></p>
</blockquote>
<p>持久性缓存将根据使用情况自动创建多个缓存文件，以优化对缓存的读写访问。</p>
<p>算法使用hash算法，默认为md4</p>
<p>默认情况下，时间戳将用于开发模式的快照，而文件哈希将用于生产模式。文件哈希也允许在 CI 中使用持久性缓存。</p>
<h5 id="什么影响？——监视模式下的增量构建速度很快，但是重新启动Webpack可能会非常慢。"><a href="#什么影响？——监视模式下的增量构建速度很快，但是重新启动Webpack可能会非常慢。" class="headerlink" title="什么影响？——监视模式下的增量构建速度很快，但是重新启动Webpack可能会非常慢。"></a>什么影响？——监视模式下的增量构建速度很快，<em>但是</em>重新启动Webpack可能会非常慢。</h5><h6 id="关于编译器的空闲和关闭"><a href="#关于编译器的空闲和关闭" class="headerlink" title="关于编译器的空闲和关闭"></a>关于编译器的空闲和关闭</h6><p>现在编译器需要在使用后被关闭。编译器会进入/离开空闲状态，并且有这些状态的钩子。一些插件可能是用这些钩子来做不重要的工作（例如持续缓存会缓慢的存储缓存到磁盘上）。（默认在空闲10000ms时，会开始进行缓存存储<code>cache.idleTimeout</code>）。在编译器关闭时——所有剩余的工作应该尽快完成。将会有一个callback标志关闭完成。</p>
<p>插件及其作者应该注意，某些用户会忘记关闭编译器。所以，所有的工作在空闲状态也可以下最终完成。当工作正在进行时，我们应该放置进程退出。</p>
<p>当被传递回调时，<code>webpack()</code>方法将会自动调用<code>close</code></p>
<p><em>迁移</em>：将使用Node.js API时，要保证完成工作时调用<code>Compiler.close</code>。</p>
<p>######关于文件生成</p>
<p>过去：</p>
<p> 总是在第一次构建时发出所有的输出文件，但在增量（观察）构建时跳过了写入未更改的文件。（假设在 webpack 运行时，没有任何其他东西改变输出文件。）</p>
<p>现在：</p>
<p>增加了持久性缓存后，不能认为即使在 webpack 不运行时也没有其他东西改变输出目录。</p>
<p>所以 webpack 现在会检查输出目录中现有的文件，并将其内容与内存中的输出文件进行比较。只有当文件被改变时，它才会写入文件。 这只在第一次构建时进行。在运行中的 webpack 进程中，任何增量构建都会在生成新的资产(assets)时写入文件。</p>
<h5 id="我们怎么用？"><a href="#我们怎么用？" class="headerlink" title="我们怎么用？"></a>我们怎么用？</h5><blockquote>
<p><a href="https://github.com/webpack/changelog-v5/blob/master/guides/persistent-caching.md" target="_blank" rel="noopener">https://github.com/webpack/changelog-v5/blob/master/guides/persistent-caching.md</a></p>
</blockquote>
<p>首先，请注意默认情况下不启用持久性缓存。我们必须选择使用它。</p>
<p>这是为什么？webpack试图强调安全性而非性能。我们不想默认启用一项功能，该功能将使您的性能提高95％，但会使您的应用程序/工作流/构建中断5％。</p>
<p>听起来好像坏了，但相信我，事实并非如此。但这需要开发人员采取额外的步骤来正确配置它。</p>
<p><em>我们可以直接使用序列化和反序列化，但是无法立即使用缓存失效</em></p>
<p>缓存失效：webpack需要找出什么时候缓存不再有效，并停止将其用于构建，</p>
<p>因此，当在应用程序中更改文件时，就会发生缓存失效</p>
<p>例如：更改了magic.js， webpack必须使magic.js的缓存条目失效。构建将会再次处理这个文件。例如 运行babel、typescript等等，然后解析文件并再次运行code generation。然后，webpack可能还会使bundle.js的缓存条目无效，并且构建将从包含的模块中重建该文件。</p>
<p>为此webpack会跟踪每个模块的<code>fileDependencies</code> <code>contextDependencies</code>和<code>missingDependencies</code>，并创建文件系统快照。将该快照与真实文件系统进行比较，并且当检测到差异时，将触发该模块的重建。</p>
<p>然后，对于的缓存条目<code>bundle.js</code>，webpack将存储一个<code>etag</code>，这是所有贡献者的哈希值。比较<code>etag</code>，并且仅当它与缓存条目匹配时才可以使用</p>
<p>以上这些对于webpack 4中的内存缓存也是必要的。并且以上特性开发人员可以直接使用，而无需额外的配置。对于webpack 5中的持久缓存，存在新的挑战。</p>
<p>webpack还需要使缓存条目无效：</p>
<ul>
<li>当您npm升级加载程序或插件时</li>
<li>当您更改配置时</li>
<li>当您更改正在配置中读取的文件时</li>
<li>npm升级配置中使用的依赖项时</li>
<li>当您将不同的命令行参数传递给构建脚本时</li>
<li>当您拥有自定义的构建脚本并进行更改时</li>
</ul>
<h3 id="关于长期缓存"><a href="#关于长期缓存" class="headerlink" title="关于长期缓存"></a>关于长期缓存</h3><h4 id="webpack-怎么做长期缓存？"><a href="#webpack-怎么做长期缓存？" class="headerlink" title="webpack 怎么做长期缓存？"></a>webpack 怎么做长期缓存？</h4><p>修改了某个模块的代码，不会破坏其他模块的缓存，这就是我们想要实现的持久性缓存</p>
<h5 id="确定的-Chunk、模块-ID-和导出名称"><a href="#确定的-Chunk、模块-ID-和导出名称" class="headerlink" title="确定的 Chunk、模块 ID 和导出名称"></a>确定的 Chunk、模块 ID 和导出名称</h5><p>新增了长期缓存的算法。这些算法在生产模式下是默认启用的。</p>
<p>在以前，默认情况下，Webpack根据顺序为模块分配整数ID。因此，在更改模块时，所有ID可能都会更改，从而使缓存无效。</p>
<p>该算法以确定性方式为模块和块分配短（3或5位数字）数字ID，并为导出分配短（2个字符）名称。这是包大小和长期缓存之间的折衷方案。由于这些配置将使用确定的 ID 和名称，<strong>这意味着生成的缓存失效不再更频繁</strong>。</p>
<h5 id="真正的内容哈希"><a href="#真正的内容哈希" class="headerlink" title="真正的内容哈希"></a>真正的内容哈希</h5><p>当使用<code>[contenthash]</code>时，Webpack 5 将使用真正的文件内容哈希值。之前它 “只 “使用内部结构的哈希值。当只有注释被修改或变量被重命名时，这对长期缓存会有积极影响。这些变化在压缩后是不可见的。</p>
<h3 id="关于改善-bundle-size"><a href="#关于改善-bundle-size" class="headerlink" title="关于改善 bundle size"></a>关于改善 bundle size</h3><h4 id="tree-shaking"><a href="#tree-shaking" class="headerlink" title="tree-shaking"></a>tree-shaking</h4><p><code>import()</code>允许通过<code>/* webpackExports: [&quot;abc&quot;, &quot;default&quot;] */</code>魔术注释手动摇动模块。</p>
<h5 id="嵌套"><a href="#嵌套" class="headerlink" title="嵌套"></a>嵌套</h5><p>webpack 现在能够跟踪对导出的嵌套属性的访问。（清除未使用的导出和混淆导出）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// inner.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> b = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// module.js</span></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">as</span> inner <span class="keyword">from</span> <span class="string">'./inner'</span>;</span><br><span class="line"><span class="comment">// or import * as inner from './inner'; export &#123; inner &#125;;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// user.js</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="built_in">module</span> <span class="keyword">from</span> <span class="string">'./module'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">module</span>.inner.a);</span><br><span class="line">In <span class="keyword">this</span> example, the <span class="keyword">export</span> b can be removed <span class="keyword">in</span> production mode.</span><br></pre></td></tr></table></figure>

<p>在这个例子中，可以在生产模式下删除导出的<code>b</code>。</p>
<h5 id="内部模块"><a href="#内部模块" class="headerlink" title="内部模块"></a>内部模块</h5><p>webpack 4 没有分析模块的 export 和 import 之间的依赖关系。webpack 5 有一个新的选项 <code>optimization.innerGraph</code>，在生产模式下是默认启用的，它可以对模块中的标志进行分析，找出 export 和 import 之间的依赖关系。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; something &#125; <span class="keyword">from</span> <span class="string">'./something'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">usingSomething</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> something;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> usingSomething();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>内部依赖图算法会找出 <code>something</code> 只有在使用 <code>test</code> 导出时才会使用。这允许将更多的 export 标记为未使用，并从代码包中省略更多的代码。</p>
<p>注意：使用 <code>eval()</code> 将为一个模块放弃这个优化，因为经过 eval 的代码可以引用范围内的任何标记。这种优化也被称为深度范围分析。</p>
<h5 id="CommonJs"><a href="#CommonJs" class="headerlink" title="CommonJs"></a>CommonJs</h5><p>webpack 曾经不进行对 CommonJs 导出和 <code>require()</code> 调用时的导出使用分析。</p>
<p>webpack 5 增加了对一些 CommonJs 构造的支持，允许消除未使用的 CommonJs 导出，并从 <code>require()</code> 调用中跟踪引用的导出名称。</p>
<h4 id="code-generation"><a href="#code-generation" class="headerlink" title="code generation"></a>code generation</h4><p>webpack会检测何时发生ASI，并且在未插入分号时会生成较短的代码。<code>Object(...)</code>-&gt;<code>(0, ...)</code></p>
<p>webpack将多个导出 getter 合并为一个运行时函数调用：<code>r.d(x, &quot;a&quot;, () =&gt; a); r.d(x, &quot;b&quot;, () =&gt; b);</code>-&gt;<code>r.d(x, {a: () =&gt; a, b: () =&gt; b});</code></p>
<p>webpack 4仅用于发出ES5代码。webpack 5现在可以生成ES5和ES6 / ES2015代码。</p>
<p>仅支持现代的浏览器，将使用箭头功能生成较短的代码，并使用<code>const</code>TDZ for的声明生成更多符合规范的代码<code>export default</code>。</p>
<h3 id="关于改善与-Web-平台的兼容性"><a href="#关于改善与-Web-平台的兼容性" class="headerlink" title="关于改善与 Web 平台的兼容性"></a>关于改善与 Web 平台的兼容性</h3><h4 id="不再为-Node-js-模块-自动引用-Polyfills"><a href="#不再为-Node-js-模块-自动引用-Polyfills" class="headerlink" title="不再为 Node.js 模块 自动引用 Polyfills"></a>不再为 Node.js 模块 自动引用 Polyfills</h4><blockquote>
<p>早期，webpack的目标是允许在浏览器中运行大多数Node.js模块，但是模块格局发生了变化，现在许多模块用途的编写主要是出于前端目的。webpack &lt;= 4带有许多Node.js核心模块的polyfill，一旦模块使用了任何核心模块（即<code>crypto</code>模块），这些模块就会自动应用。</p>
<p>虽然这使使用为Node.js编写的模块变得容易，但它会将这些巨大的polyfill添加到包中。在许多情况下，这些填充材料是不必要的。</p>
<p>webpack 5会自动停止填充这些核心模块，并专注于与前端兼容的模块。我们的目标是提高与Web平台的兼容性，在Web平台上，Node.js核心模块不可用。</p>
</blockquote>
<p>如果你的代码中有引用这些 <code>Node.js</code> 的模块，要升级到 <code>webpack 5</code>, 将尽量使用前端的模块，或者自行手动添加适合的 <code>Polyfills</code>。</p>
<p>而针对那些类库的开发者，请在 <code>package.json</code> 中定义 <code>browser</code> 字段，使类库在前端能适用。</p>
<h3 id="关于迁移"><a href="#关于迁移" class="headerlink" title="关于迁移"></a>关于迁移</h3><blockquote>
<p>webpack迁移文档：<a href="https://webpack.js.org/migrate/5/" target="_blank" rel="noopener">https://webpack.js.org/migrate/5/</a></p>
<p>angular11文档：<a href="https://indepth.dev/posts/1388/angular-11-towards-type-safety" target="_blank" rel="noopener">https://indepth.dev/posts/1388/angular-11-towards-type-safety</a></p>
<p>升级angular11文档：<a href="https://update.angular.io/?v=9.1-11.0" target="_blank" rel="noopener">https://update.angular.io/?v=9.1-11.0</a></p>
</blockquote>
<p>webpack 5的最低node.js版本为10.13.0</p>
<p>现状：</p>
<p>![WeChatWorkScreenshot_4c8cb24d-eef6-4790-9a74-42d87aa318fa](/Users/rickie/Library/Containers/com.tencent.WeWorkMac/Data/Library/Application Support/WXWork/Temp/ScreenCapture/WeChatWorkScreenshot_4c8cb24d-eef6-4790-9a74-42d87aa318fa.png)</p>
<p>![WeChatWorkScreenshot_24eab8ca-1433-41cb-9686-ba56b4cdc296](/Users/rickie/Library/Containers/com.tencent.WeWorkMac/Data/Library/Application Support/WXWork/Temp/ScreenCapture/WeChatWorkScreenshot_24eab8ca-1433-41cb-9686-ba56b4cdc296.png)</p>
<p>升级Angular = 11</p>
<p>![image-20201214173622039](/Users/rickie/Library/Application Support/typora-user-images/image-20201214173622039.png)</p>
<p>![image-20201214173649535](/Users/rickie/Library/Application Support/typora-user-images/image-20201214173649535.png)</p>
<p>![image-20201214173717556](/Users/rickie/Library/Application Support/typora-user-images/image-20201214173717556.png)</p>
<p>升级到 weback = 5.0.0</p>
<p>![image-20201214175449325](/Users/rickie/Library/Application Support/typora-user-images/image-20201214175449325.png)</p>
<p>解决：</p>
<p>yarn add <a href="mailto:rxjs-tslint@0.1.5">rxjs-tslint@0.1.5</a> -D</p>
<p>需要指定版本。。且需要降版本到0.1.5</p>
<p>then</p>
<p>![image-20201214181031819](/Users/rickie/Library/Application Support/typora-user-images/image-20201214181031819.png)</p>
<p>By : <a href="https://stackoverflow.com/questions/64361940/webpack-error-configuration-node-has-an-unknown-property-fs" target="_blank" rel="noopener">https://stackoverflow.com/questions/64361940/webpack-error-configuration-node-has-an-unknown-property-fs</a></p>
<p>![image-20201214181204709](/Users/rickie/Library/Application Support/typora-user-images/image-20201214181204709.png)</p>
<p>finally</p>
<p>直播项目引入了jszip，这里用了stream</p>
<p>![image-20201214182343009](/Users/rickie/Library/Application Support/typora-user-images/image-20201214182343009.png)</p>
<p>![image-20201214184152985](/Users/rickie/Library/Application Support/typora-user-images/image-20201214184152985.png)</p>
<p>![image-20201214184227357](/Users/rickie/Library/Application Support/typora-user-images/image-20201214184227357.png)</p>
<p>![image-20201214184316771](/Users/rickie/Library/Application Support/typora-user-images/image-20201214184316771.png)</p>
<hr>
<p>在新站</p>
<p>![image-20201214202259262](/Users/rickie/Library/Application Support/typora-user-images/image-20201214202259262.png)</p>
<p>recomplie</p>
<p>![image-20201214202454418](/Users/rickie/Library/Application Support/typora-user-images/image-20201214202454418.png)</p>
<p>angular 11，antd不支持，mkd不支持</p>
<p>![image-20201214211347225](/Users/rickie/Library/Application Support/typora-user-images/image-20201214211347225.png)</p>
<p>![image-20201214211217405](/Users/rickie/Library/Application Support/typora-user-images/image-20201214211217405.png)</p>
<p>![image-20201214212316268](/Users/rickie/Library/Application Support/typora-user-images/image-20201214212316268.png)</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Rickie Woo"
      src="/images/sasuke.jpeg">
  <p class="site-author-name" itemprop="name">Rickie Woo</p>
  <div class="site-description" itemprop="description">We were both young when I first saw you.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">37</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/rickiewoo" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;rickiewoo" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:rickiemeow@gmail.com" title="E-Mail → mailto:rickiemeow@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://plus.google.com/rickiewoo" title="Google → https:&#x2F;&#x2F;plus.google.com&#x2F;rickiewoo" rel="noopener" target="_blank"><i class="fab fa-google fa-fw"></i>Google</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/3296105801" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;3296105801" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Rickie Woo</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
